require.config({baseUrl:"assets/js",paths:{jquery:"jquery.min","jquery-weui":"jquery-weui","jquery.fullPage":"jquery.fullPage.min"},shim:{"jquery.fullPage":{deps:["jquery"]},"jquery-weui":{deps:["jquery"]}}});var exam={loadComplete:!1,total:0,error:[],answerList:[],isAnswered:[],timeReleased:!1,isStarted:!1,timeLength:0,sourceList:[],scoresPerAnswer:0,isSubmit:!1,isLogin:!1,loginData:{},maxAnswerNum:20,answerTimes:2,examPaper:"safe"},lastPage;require(["jquery.fullPage","jquery-weui"],function(){function e(e,a){var n=[],i=[];i=t(e.question.length);var s=[];i.map(function(e,a){s[e]=a});var o='<div class="section '+(a%2?"":"background_dark_img")+'">';o+='<h1 class="title answer-num ">第<span>'+a+"</span>题</h1>",o+='<div class="weui_cells_title ">'+e.title+"</div>",o+='<div class="weui_cells weui_cells_checkbox'+(a%2?"":" weui_cells_dark")+'" data-id='+(a-1)+" data-answer="+(s[e.answer-1]+1)+">",e.question.map(function(e,t){n[t]="",n[t]+='    <label class="weui_cell weui_check_label">',n[t]+='<div class="weui_cell_hd">',n[t]+='    <input type="radio" class="weui_check" name="radio'+(a-1)+'">',n[t]+='    <i class="weui_icon_checked"></i>',n[t]+="</div>",n[t]+='<div class="weui_cell_bd weui_cell_primary" data-value='+s[t]+">",n[t]+="    <p>"+e+"</p>",n[t]+="</div></label>"});for(var r="",l=0;l<e.question.length;l++)r+=n[i[l]];return o+=r+"</div></div>"}function a(e,a){return Math.random()>.5?-1:1}function t(e){for(var t=[],n=0;e>n;n++)t.push(n);return t.sort(a)}function n(e,a){return e.substring(e.length-a,e.length)}function i(e){var a,t=new Date,i=t.getFullYear(),s=n("0"+(t.getMonth()+1),2),o=n("0"+t.getDate(),2),r=t.getHours(),l=t.getMinutes(),u=t.getSeconds();switch(e){case 0:a=i+"年"+s+"月"+o+"日";break;case 1:a=i+"-"+s+"-"+o+" "+r+":"+l+":"+u;break;case 2:a=i+"年"+s+"月"+o+"日"+r+"时"+l+"分"+u+"秒";break;case 3:a=i+"-"+s+"-"+o+" "+r+":"+l;break;case 4:a=i+"年"+s+"月"+o+"日  "+r+"时"+l+"分";break;case 5:a=s+"/"+o+"/"+i;break;case 6:a=i+"-"+s+"-"+o}return a}var s=[];$('[name="sucessInfo"] .weui_msg_title').hide(),$.getJSON("./assets/data/department.min.json",function(e){var a=(e.length,[]);e.map(function(e){a.push(e.name)}),$('[name="user_dpt"]').picker({title:"上下滑动选择您的部门",cols:[{textAlign:"center",values:a}]})}),$.getJSON("./assets/data/"+exam.examPaper+".min.json",function(a){var n=a.length;exam.sourceList=t(n),n=n<=exam.maxAnswerNum?n:exam.maxAnswerNum,exam.maxAnswerNum=n,$('[name="nums"]').text(n),exam.scoresPerAnswer=100/n,$('[name="scores"]').text(exam.scoresPerAnswer.toFixed(0));for(var i=0;n>i;i++)$('[name="sucessInfo"]').before(e(a[exam.sourceList[i]],i+1)),exam.isAnswered[i]=0;var o='<div class="weui_opr_area"><p class="weui_btn_area"><a href="javascript:;" class="weui_btn weui_btn_primary" id="submit">交卷</a></p></div>';for($(".answer-num").last().parent().append(o),lastPage=n+3,i=0;lastPage>i;i++)s[i]=i%2?"#fff":"#445"}).done(function(){document.getElementById("autoplay").play(),o()});var o=function(){function e(){$.alert("答题时间到，系统将不再记录此后的得分，请提交当前成绩！","时间到！",function(){$.fn.fullpage.moveTo(lastPage)})}function a(e,a,t){var n=e-2;return"down"!=t||exam.isLogin||exam.timeReleased?("down"==t&&!exam.timeReleased&&n>0&&lastPage-2>n&&!exam.isAnswered[n-1]&&$.alert("第"+n+"题您还没有作答！","警告！",function(){$.fn.fullpage.moveTo(e)}),void(e>lastPage&&"down"==t&&$(".iSlider-arrow").hide())):void setTimeout(function(){$.fn.fullpage.moveTo(2)},200)}function t(e){var a=!0;return""==e.user_name?($('[name="userName"]').parents(".weui_cell").find("label").css("color","#e64340"),a=!1):$('[name="userName"]').parents(".weui_cell").find("label").attr("style",""),""==e.user_dpt?($('[name="user_dpt"]').parents(".weui_cell").find("label").css("color","#e64340"),a=!1):$('[name="user_dpt"]').parents(".weui_cell").find("label").attr("style",""),""==e.user_id?($('[name="userCard"]').parents(".weui_cell").find("label").css("color","#e64340"),a=!1):$('[name="userCard"]').parents(".weui_cell").find("label").attr("style",""),a}function n(e,a){var t="";e>=80?t="恭喜您获奖！请根据部门通知领取答题奖品！":(1==exam.loginData.iTimes&&(t="您还有一次答题机台，退出页面重新进入即可，下次继续努力哦！"),t="下次继续努力哦！安全生产离不开您的参与！"),$('[name="sucessInfo"] .weui_msg_desc').html('提交成功，您一共得了<span name="totalScore" style="font-weight:bold;color:#445"> '+e+" </span>分"),$(".weui_icon_msg").last().addClass("weui_icon_success").removeClass("weui_icon_warn"),$('[name="scoreLink"]').attr("href","./safeScore.html?uid="+a),$('[name="sucessInfo"] .weui_msg_title').text(t).show()}function s(){var e=!0;exam.isAnswered.map(function(a,t){if(!a){var n=t+1;$.toast("第"+n+"题尚未作答，请先填写完所有题目再交卷"),e=!1}})}function o(e){$.ajax({url:"http://cbpc540.applinzi.com/index.php?s=/addon/GoodVoice/GoodVoice/setSafeExamData",data:e,success:function(a){0==a.status?$('[name="sucessInfo"] .weui_msg_title').text("提交失败，请稍后重试"):-1==a.status?$('[name="sucessInfo"] .weui_msg_title').text("该用户已提交数据"):(n(e.score,e.uid),e.score==exam.loginData.oldScore?$.alert("本次得分"+e.score+"与上一次相同，系统将不保存此次得分","警告！"):e.score<exam.loginData.oldScore&&$.alert("系统检测到本次得分"+e.score+"比上次更低，系统将不保存此次得分","警告！")),$.fn.fullpage.moveSectionDown()},error:function(e){var a="提交失败，请退出页面重新进入";$('[name="sucessInfo"] .weui_msg_title').text(a).show()}}).always(function(){exam.isSubmit=!0,$("#submit").hide()})}$(".weui_check_label").on("click",function(e){if(exam.timeReleased)e.preventdefault(),$.fn.fullpage.moveTo(lastPage),$.alert("答题时间到，系统将不再记录此后的得分，请提交当前成绩！","时间到！");else{var a=$(this).parents(".weui_cells"),t=$(this).find(".weui_cell_primary"),n=t.data("value")+1==a.data("answer")?1:0,i=a.data("id");exam.answerList[i]=n,exam.isAnswered[i]=1,i<exam.maxAnswerNum-1&&setTimeout(function(){$.fn.fullpage.moveTo(i+4)},300)}}),$("#fullpage").fullpage({easingcss3:"cubic-bezier(0.25, 0.5, 0.35, 1.15)",onLeave:function(t,n,i){exam.timeLength&&1==t&&!exam.timeReleased&&(exam.isStarted=!0,setTimeout(function(){exam.timeReleased=!0,e()},exam.timeLength),setTimeout(function(){$.toast("考试时间已过去三分之一")},.33*exam.timeLength),setTimeout(function(){$.toast("考试时间仅剩三分之一")},.67*exam.timeLength)),a(t,n,i)},afterLoad:function(e,a){a==lastPage-1?$(".iSlider-arrow").hide():a==lastPage?($(".iSlider-arrow").hide(),exam.isSubmit||setTimeout(function(){$.fn.fullpage.moveSectionUp()},500)):$(".iSlider-arrow").show()}}),exam.loadComplete||($("#fakeLoader").hide(),exam.loadComplete=!0),$(".weui_msg").removeClass("hidden"),$('[name="login"] input').on("focus",function(){$(this).parents(".weui_cell").find("label").attr("style","")}),$("#login").on("click",function(){var e={user_name:$('[name="userName"]').val().trim(),user_id:$('[name="userCard"]').val().trim(),user_dpt:$('[name="user_dpt"]').val()};e.user_firstname=e.user_name.substr(0,1),t(e)?$.ajax({url:"http://cbpc540.applinzi.com/index.php?s=/addon/GoodVoice/GoodVoice/examSafeLogin",data:e,success:function(a){0==a.id?$.alert("登录失败，请检查您的卡号及部门","警告！"):a.first_name.trim()!=e.user_firstname?$.alert("登录失败，您的姓名可能填写错误","警告！"):a.answer_times>=exam.answerTimes?$.alert("您已用完"+exam.answerTimes+"次答题机会","警告！"):(exam.isLogin=!0,exam.loginData=e,exam.loginData.uid=a.id,exam.loginData.iTimes=Number.parseInt(a.answer_times)+1,exam.loginData.oldScore=exam.loginData.iTimes>=1?Number.parseInt(a.score):0,exam.loginData.loginTime=i(1),exam.loginData.iTimes>1?$.modal({title:"提示",text:"您已经提交过答案，是否继续作答?",buttons:[{text:"再做一遍",onClick:function(){$(this).parents(".section").hide(),$.fn.fullpage.moveSectionDown()}},{text:"查看成绩",onClick:function(){window.location.href="./safeScore.html?uid="+a.id}}]}):($(this).parents(".section").hide(),$.fn.fullpage.moveSectionDown()))},error:function(e){$.alert("登录失败，请刷新重试","警告！")}}):$.toast("请输入个人用户信息","cancel")}),$("#submit").on("click",function(e){if(exam.error=[],exam.total=0,exam.answerList.map(function(e,a){exam.total+=e,e||exam.error.push(exam.sourceList[a])}),s){var a="";exam.error.map(function(e){a+=e+","}),a=a.length?a.substring(0,a.length-1):"-1";var t={score:(exam.total*exam.scoresPerAnswer).toFixed(0),errors:a,rec_time:i(1),start_time:exam.loginData.loginTime,uid:exam.loginData.uid,iTimes:exam.loginData.iTimes,oldScore:exam.loginData.oldScore};$.confirm("您确定要交卷吗?","交卷",function(){o(t)},function(){$.fn.fullpage.moveTo(2)}),$.modal({title:"提示",text:"您确定要交卷吗?",buttons:[{text:"交卷",onClick:function(){o(t)}},{text:"检查一遍",onClick:function(){$.fn.fullpage.moveTo(3)}}]})}})};(function(){var e=document.getElementById("autoplay"),a=document.getElementById("musicBtn"),t=document.getElementById("musicBtnTxt");document.getElementById("musicBtn").addEventListener("touchstart",function(){t.style.display="",e.paused?(e.play(),a.className="music-btn on",t.innerHTML="开始"):(e.pause(),a.className="music-btn",t.innerHTML="关闭"),setTimeout(function(){t.style.display="none"},1e3)},!1)})()});
//# sourceMappingURL=safe.min.js.map