var worklogEdit=function(){function e(){iChechBoxInit(),initSelect2(),$("#ErrDesc").summernote({height:300,minHeight:null,maxHeight:null,focus:!0}),$(".form_advance_datetime").datetimepicker({isRTL:App.isRTL(),format:"yyyy-mm-dd hh:ii",autoclose:!0,todayBtn:!0,startDate:"2015-01-01 00:00",pickerPosition:App.isRTL()?"bottom-right":"bottom-left",minuteStep:10,language:"zh-CN"}),t(),n(),RoundedTheme(0),HeadFix(),$("#today").text(today(0)),SetiCheckChecked("proc_id",$('div[name="proc_id"]').data("proc")),SetSingleiCheck("bReport",!0),i(),c(),initDashboardDaterange("YYYY-MM-DD"),$('input[name="process_time"]').val(today(3))}function a(e){var a=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=42&M=0&id="+e,t=ReadData(a);SetiCheckChecked("proc_id",t.data[0].proc_id),SetiCheckChecked("class_id",t.data[0].class_id),$('input[name="rec_user_name"]').val(t.data[0].rec_user_name),SetSingleiCheck("bReport",t.data[0].bReport),SetSelect2Val("prod_id",t.data[0].prod_id),SetSelect2Val("machine_id",t.data[0].machine_id),SetSelect2Val("proStatus_id",t.data[0].proStatus_id),$('input[name="process_time"]').val(t.data[0].process_time),$('input[name="prod_info"]').val(t.data[0].prod_info);var i=[];t.data[0].oper_name.split(",").map(function(e){i.push($("select[name='oper_name']").find("option:contains("+e+")").val())}),$("select[name='oper_name']").select2("val",i),SetSelect2Val("main_err",t.data[0].main_err),SetSelect2Val("sub_err",t.data[0].sub_err);var c=$('input[name="rec_user_name"]').data("user");$("#ErrDesc").summernote("code",GBK2UTF(t.data[0].ErrDesc)+'<p><div class="note note-info"><h4 class="block">'+c+"&nbsp;<small>"+today(3)+'&nbsp;:</small></h4><p><span style="font-size: 14px; line-height: 20px;">&nbsp;</span></p></div></p>'),$("#Save").data("sn",t.data[0].id),$("#Save").html($("#Save").html().replace("提交","更新"))}function t(){var e=(new Date).getHours();e>=0&&8>e?SetiCheckChecked("class_id",2):e>=8&&16>e?SetiCheckChecked("class_id",0):SetiCheckChecked("class_id",1)}function i(){var e,a,t,i=GetiCheckChecked("proc_id");switch(i){case"0":e=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=24&M=3",a=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=23&M=3";break;default:e=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=35&M=3",a=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=36&M=3&p="+i}t=ReadData(e),InitSelect("prod_id",t),t=ReadData(a),InitSelect("machine_id",t),e=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=38&M=3&p="+i,t=ReadData(e),InitSelect("oper_name",t)}function c(){var e,a;e=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=39&M=3",a=ReadData(e),InitSelect("main_err",a)}function n(){var e=getRootUrl("worklog")+"ReadLogQuerySettings";$.ajax({type:"POST",async:!1,url:e,success:function(e){var a=jQuery.parseJSON(e),t=a.data[0];$("#proc_id").val(t.ProcID),$('div[name="proc_id"]').data("proc",t.ProcID),$("#RefreshTime").val(t.RefreshTime),0===t.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState")}})}return $('select[name="main_err"]').on("change",function(){str=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=40&M=3&p="+$(this).val(),Data=ReadData(str),InitSelect("sub_err",Data)}),$("#Save").on("click",function(){var e={tbl:TBL.WORK_LOG,rec_time:today(1),utf2gbk:["oper_name","rec_user_name"],oper_name:GetSelect2Text("oper_name"),proc_id:GetiCheckChecked("proc_id"),class_id:GetiCheckChecked("class_id"),rec_user_name:$('input[name="rec_user_name"]').val().trim(),bReport:GetiCheckChecked("bReport")?0:1,prod_id:$('select[name="prod_id"]').val(),machine_id:$('select[name="machine_id"]').val(),proStatus_id:$('select[name="proStatus_id"]').val(),process_time:$('input[name="process_time"]').val(),prod_info:$('input[name="prod_info"]').val(),main_err:$('select[name="main_err"]').val(),sub_err:$('select[name="sub_err"]').val(),ErrDesc:UTF2GBK($("#ErrDesc").summernote("code"))},a=getRootPath()+"/DataInterface/insert";"undefined"!=typeof $("#Save").data("sn")&&(a=getRootPath()+"/DataInterface/update",e.id=$("#Save").data("sn")),$.post(a,e,function(e,a){if("success"==a){var t=$.parseJSON(e);infoTips(t.message,t.type),$("#Reset").click(),"undefined"!=typeof $("#Save").data("sn")&&($("#Save").removeAttr("data-sn"),$("#Save").html($("#Save").html().replace("更新","提交")))}else infoTips("日志添加失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(e))})}),$(document).on("click","#Reset",function(){ResetSelect2("prod_id"),ResetSelect2("machine_id"),ResetSelect2("ProStatus"),ResetSelect2("oper_name"),SetSelect2Val("main_err",-1),ResetSelect2("sub_err"),$("#ErrDesc").summernote("code",""),$('input[name="prod_info"]').val(""),$('input[name="process_time"]').val("")}),$("#SaveSettings").on("click",function(){var e=$("#proc_id").val(),a=$("#RefreshTime").val(),t=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,i=getRootUrl("worklog")+"SaveLogQuerySettings";$.post(i,{ProcID:e,RefreshTime:a,AutoRefresh:t},function(e,a){if("success"==a){var t=jQuery.parseJSON(e);infoTips(t.message,1)}else infoTips("保存设置失败，请稍后重试或联系管理员!",0)})}),{init:function(){initDom(),e(),$('input[name="proc_id"]').on("ifChecked",function(){$('div[name="proc_id"]').data("proc",GetiCheckChecked("proc_id")),i()}),getUrlParam("ID")&&a(getUrlParam("ID"))}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),worklogEdit.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=WorkLogEdit.min.js.map