var worklogEdit=function(){function e(){iCheckBoxInit(),initSelect2();$("#ErrDesc").summernote({height:300,minHeight:null,maxHeight:null,focus:!0,lang:"zh-CN",placeholder:"在这里填入机检日志信息",dialogsInBody:!0,codemirror:{theme:"rubyblue",mode:"htmlmixed",htmlMode:!0,lineNumbers:!0},dialogsFade:!0,disableDragAndDrop:!1,fontNames:["Microsoft JhengHei","微软雅黑","Arial","黑体","sans-serif","Arial Black","Comic Sans MS","Courier New","Helvetica","Impact","Tahoma","Times New Roman","Verdana"],toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["font",["strikethrough","superscript","subscript"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","hr","iFrame"]],["insert",["undo","redo"]],["view",["fullscreen","codeview","help"]]],fontSizes:["8","9","10","11","12","14","18","24","36","48","72"],tableClassName:"table table-striped table-bordered table-hover",insertTableMaxSize:{col:20,row:30}}),$(".form_advance_datetime").datetimepicker({isRTL:App.isRTL(),format:"yyyy-mm-dd hh:ii",autoclose:!0,todayBtn:!0,startDate:"2016-01-01 00:00",pickerPosition:App.isRTL()?"bottom-right":"bottom-left",minuteStep:10,language:"zh-CN"}),a(),o(),RoundedTheme(0),HeadFix(),$("#today").text(today(0)),SetiCheckChecked("proc_id",$('div[name="proc_id"]').data("proc")),i(),initDashboardDaterange("YYYY-MM-DD"),$('input[name="process_time"]').val(today(3))}function t(e){var t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=42&M=0&id="+e,a=ReadData(t);SetiCheckChecked("proc_id",a.data[0].proc_id),SetiCheckChecked("class_id",a.data[0].class_id),$('input[name="rec_user_name"]').val(a.data[0].rec_user_name),SetSelect2Val("prod_id",a.data[0].prod_id),SetSelect2Val("machine_id",a.data[0].machine_id),SetSelect2Val("proStatus_id",a.data[0].proStatus_id),$('input[name="process_time"]').val(a.data[0].process_time),$('input[name="prod_info"]').val(a.data[0].prod_info);var i=[];a.data[0].oper_name.split(",").map(function(e){i.push($("select[name='oper_name']").find("option:contains("+e+")").val())}),$("select[name='oper_name']").select2("val",i);var o=$('input[name="rec_user_name"]').data("user");$("#ErrDesc").summernote("code",GBK2UTF(a.data[0].ErrDesc)+'<p><div class="note note-info"><h4 class="block">'+o+"&nbsp;<small>"+today(3)+'&nbsp;:</small></h4><p><span style="font-size: 14px; line-height: 20px;">&nbsp;</span></p></div></p>'),$("#Save").data("sn",a.data[0].id),$("#Save").html($("#Save").html().replace("提交","更新"))}function a(){var e=(new Date).getHours();e>=0&&8>e?SetiCheckChecked("class_id",2):e>=8&&16>e?SetiCheckChecked("class_id",0):SetiCheckChecked("class_id",1)}function i(){var e,t,a,i=GetiCheckChecked("proc_id");switch(i){case"0":e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=24&M=3",t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=23&M=3";break;default:e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=35&M=3",t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=36&M=3&p="+i}a=ReadData(e),InitSelect("prod_id",a),a=ReadData(t),InitSelect("machine_id",a),e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=38&M=3&p="+i,a=ReadData(e),InitSelect("oper_name",a)}function o(){var e=getRootUrl("worklog")+"ReadLogQuerySettings";$.ajax({type:"POST",async:!1,url:e,success:function(e){var t=jQuery.parseJSON(e),a=t.data[0];$("#proc_id").val(a.ProcID),$('div[name="proc_id"]').data("proc",a.ProcID),$("#RefreshTime").val(a.RefreshTime),0===a.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState")}})}return $("#Save").on("click",function(){var e={tbl:TBL.WORK_LOG,rec_time:today(1),utf2gbk:["oper_name","rec_user_name"],oper_name:GetSelect2Text("oper_name"),proc_id:GetiCheckChecked("proc_id"),class_id:GetiCheckChecked("class_id"),rec_user_name:$('input[name="rec_user_name"]').val().trim(),prod_id:$('select[name="prod_id"]').val(),machine_id:$('select[name="machine_id"]').val(),proStatus_id:$('select[name="proStatus_id"]').val(),process_time:$('input[name="process_time"]').val(),prod_info:$('input[name="prod_info"]').val(),ErrDesc:UTF2GBK($("#ErrDesc").summernote("code"))},t=getRootPath()+"/DataInterface/insert";"undefined"!=typeof $("#Save").data("sn")&&(t=getRootPath()+"/DataInterface/update",e.id=$("#Save").data("sn")),$.ajax({url:t,type:"POST",data:e,success:function(e){var t=$.parseJSON(e);bsTips(t.message,t.type),$("#Reset").click(),"undefined"!=typeof $("#Save").data("sn")&&($("#Save").removeAttr("data-sn"),$("#Save").html($("#Save").html().replace("更新","提交")))},error:function(e){bsTips("日志添加失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(e))}})}),$(document).on("click","#Reset",function(){ResetSelect2("prod_id"),ResetSelect2("machine_id"),ResetSelect2("oper_name"),$("#ErrDesc").summernote("code",""),$('input[name="prod_info"]').val(""),$('input[name="process_time"]').val("")}),$("#SaveSettings").on("click",function(){var e=$("#proc_id").val(),t=$("#RefreshTime").val(),a=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,i=getRootUrl("worklog")+"SaveLogQuerySettings";$.post(i,{ProcID:e,RefreshTime:t,AutoRefresh:a},function(e,t){if("success"==t){var a=jQuery.parseJSON(e);infoTips(a.message,1)}else infoTips("保存设置失败，请稍后重试或联系管理员!",0)})}),{init:function(){initDom(),e(),$('input[name="proc_id"]').on("ifChecked",function(){$('div[name="proc_id"]').data("proc",GetiCheckChecked("proc_id")),i()}),getUrlParam("ID")&&t(getUrlParam("ID"))}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),worklogEdit.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=WorkLogEdit.min.js.map