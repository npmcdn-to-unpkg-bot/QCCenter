function SaveSettings(){var e=$("#RefreshTime").val(),t=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,a=$("#FixTblHead").bootstrapSwitch("state")===!0?1:0,i=$("#FixTblCol").bootstrapSwitch("state")===!0?1:0,o=$("#FootSearch").bootstrapSwitch("state")===!0?1:0,n=$("#InputToggle").bootstrapSwitch("state")===!0?1:0,l=$("#InputInner").bootstrapSwitch("state")===!0?1:0,s=getRootUrl("QualityTable")+"/SaveSettings";$.post(s,{RefreshTime:e,AutoRefresh:t,FixTblHead:a,FixTblCol:i,FootSearch:o,InputToggle:n,InputInner:l},function(e,t){if("success"==t){var a=jQuery.parseJSON(e);infoTips(a.message,1)}else infoTips("保存设置失败，请稍后重试或联系管理员!",0)})}function ReadSettings(){var e=getRootPath()+"/QualityTable/ReadSettings";$.ajax({type:"POST",async:!1,url:e,success:function(e){var t=jQuery.parseJSON(e),a=t.data[0];$("#RefreshTime").val(a.RefreshTime),0===a.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState"),0===a.FixTblHead&&$("#FixTblHead").bootstrapSwitch("toggleState"),0===a.FixTblCol&&$("#FixTblCol").bootstrapSwitch("toggleState"),0===a.FootSearch&&$("#FootSearch").bootstrapSwitch("toggleState"),0===a.InputToggle&&$("#InputToggle").bootstrapSwitch("toggleState"),0===a.InputInner&&$("#InputInner").bootstrapSwitch("toggleState")}})}$("#HideTips").on("click",function(){$(this).parent().hide()}),$("#SaveSettings").on("click",function(){SaveSettings()});var initApiList=function(){function e(e,t){for(var a=e.fnGetData(t),i=$(">td",t),o=0,n=i.length;n>o;o++)e.fnUpdate(a[o],t,o,!1);e.fnDraw()}function t(e,t){var a=e.fnGetData(t),i=$(">td",t);i[3].innerHTML='<input type="text" class="form-control" value="'+a[3]+'">',i[4].innerHTML='<input type="text" class="form-control input-large" value="'+a[4]+'">',i[5].innerHTML='<input type="text" class="form-control" value="'+a[5]+'">',i[6].innerHTML='<a class="edit" href="javascript:;" data-sn="'+r+'">保存</a>',i[7].innerHTML='<a class="cancel" href="javascript:;" data-sn="'+r+'">取消</a>'}function a(e,t){var a=$("input",t),i={ApiName:a[0].value,strSQL:a[1].value,Params:a[2].value,utf2gbk:["ApiName","strSQL","Params"],id:r,tbl:30};if(""!==i.ApiName&&""!==i.strSQL){e.fnUpdate(a[0].value,t,3,!1),e.fnUpdate(a[1].value,t,4,!1),e.fnUpdate(a[2].value,t,5,!1),e.fnUpdate('<a class="edit" href="javascript:;" data-sn="'+r+'">编辑</a>',t,6,!1),e.fnUpdate('<a class="delete"href="javascript:;" data-sn="'+r+'">删除</a>',t,7,!1),e.fnDraw();var o=getRootPath()+"/DataInterface/update";$.post(o,i,function(e){var t=$.parseJSON(e);infoTips(t.message,t.type)})}else bsTips("接口名及查询语句不能为空")}function i(e){var t=p.fnAddData([e.ApiID,e.AuthorName,e.DBName,e.ApiName,e.strSQL,e.params,'<a class="edit" href="javascript:;" data-sn="'+e.newID+'">编辑</a>','<a class="delete" href="javascript:;" data-sn="'+e.newID+'">删除</a>']);p.fnGetNodes(t[0])}var o=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=0&M=3&t="+Math.random(),n=ReadData(o),l=CreateTableBody(n,!0);$("#apiList tbody").html(l),$("#apiList_TableTitle").text(n.title),$("#apiList_datasource").text("("+n.source+")");var s=0;App.getViewPort().width<App.getResponsiveBreakpoint("md")?$(".page-header").hasClass("page-header-fixed-mobile")&&(s=$(".page-header").outerHeight(!0)):$(".page-header").hasClass("navbar-fixed-top")&&(s=$(".page-header").outerHeight(!0));var r,c={bRetrieve:!0,language:{url:getRootPath()+"/assets/pages/controller/DataTableLanguage.min.json"},order:[[1,"asc"]],lengthMenu:[[5,10,15,20,50,100,-1],[5,10,15,20,50,100,"All"]],pageLength:15,dom:"<'row tbTools' <'col-md-6 col-sm-12 pull-right'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>>t<'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible"},text:"复制"},{extend:"excelHtml5",exportOptions:{columns:":visible"}},{extend:"csvHtml5",exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:n.cols>10?"landscape":"portrit",pageSize:n.cols>10?"A3":"A4",message:n.source+"\n?成都印钞有限公司 技术质量部",title:n.title,exportOptions:{columns:":visible"}},{extend:"print",autoPrint:!1,text:"打印",message:n.source+"<br>?成都印钞有限公司 技术质量部",title:n.title,exportOptions:{columns:":visible"}},{extend:"colvis",text:'隐藏数据列<i class="fa fa-angle-down"></i>',className:"btn-fit-height green-haze dropdown-toggle"}],bDeferRender:!0,bProcessing:!0,bStateSave:!0,bserverSide:!1,bInfo:!0,bAutoWidth:!0,bSortClasses:!1,bScrollInfinite:!0,searchHighlight:!0,fixedHeader:{header:!0,footer:!0,headerOffset:s},scroolY:"70v",scrollCollapse:!0,initComplete:function(){$("#apiList_tools").append($("#apiList").parent().find(".tabletools-btn-group").clone(!0)),$("#apiList").parent().find(".tabletools-btn-group").remove()}},d=$("#apiList"),p=d.dataTable(c),u=null;return{init:function(){d.on("click",".edit",function(i){r=$(this).attr("data-sn"),i.preventDefault();var o=$(this).parents("tr")[0];null!==u&&u!=o?(e(p,u),t(p,o),u=o):u==o&&"保存"==this.innerHTML?(a(p,u),u=null):(t(p,o),u=o,$(this).text("保存"),$(this).parent().parent().find("a:eq(1)").text("取消"),$(this).parent().parent().find("a:eq(1)").removeClass("delete"),$(this).parent().parent().find("a:eq(1)").addClass("cancel"))}),d.on("click",".delete",function(e){e.preventDefault();var t=$(this);bootbox.dialog({message:"确定删除这条信息?",title:"删除信息",buttons:{success:{label:"删除",className:"green",callback:function(){var e=getRootPath()+"/DataInterface/delete";$.post(e,{id:t.attr("data-sn"),tbl:30},function(){var e=t.parents("tr")[0];p.fnDeleteRow(e),infoTips("数据成功删除",1);var a=ReadData("http://localhost/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=29&M=3&author=develop");$("#ApiID").text(a.data[0])})}},main:{label:"取消",className:"red",callback:function(){}}}})}),d.on("click",".cancel",function(t){t.preventDefault(),e(p,u),u=null})},newRow:function(e){i(e)}}}(),dataTable=function(){function e(e){var t;return t={bRetrieve:!0,language:{url:getRootPath()+"/assets/pages/controller/DataTableLanguage.min.json"},order:[[1,"asc"]],lengthMenu:[[5,10,15,20,50,100,-1],[5,10,15,20,50,100,"All"]],pageLength:15,dom:"<'row tbTools' <'col-md-6 col-sm-12 pull-right'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>>t<'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible"},text:"复制"},{extend:"excelHtml5",exportOptions:{columns:":visible"}},{extend:"csvHtml5",exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:e.cols>10?"landscape":"portrit",pageSize:e.cols>10?"A3":"A4",message:e.source+"\n?成都印钞有限公司 技术质量部",title:e.title,exportOptions:{columns:":visible"}},{extend:"print",autoPrint:!1,text:"打印",message:e.source+"<br>?成都印钞有限公司 技术质量部",title:e.title,exportOptions:{columns:":visible"}},{extend:"colvis",text:'隐藏数据列<i class="fa fa-angle-down"></i>',className:"btn-fit-height green-haze dropdown-toggle"}],bDeferRender:!0,bProcessing:!0,bStateSave:!0,bserverSide:!1,bInfo:!0,bAutoWidth:!0,bSortClasses:!1,aoColumns:e.header,data:e.data,bScrollInfinite:!0,searchHighlight:!0,colReorder:{realtime:!0},fixedHeader:{header:e.cols>20?!1:!0,footer:e.cols>20?!1:!0,headerOffset:e.fixedHeaderOffset},scroolY:"70v",scrollCollapse:!0,initComplete:function(){var t=this.api();t.$("td").on("click",function(){t.search(this.innerText).draw()}),$(e.tblID+"_tools").append($(e.tblID).parent().find(".tabletools-btn-group").clone(!0)),$(e.tblID).parent().find(".tabletools-btn-group").remove()}}}function t(t,a){var o=$(t),n=0;App.getViewPort().width<App.getResponsiveBreakpoint("md")?$(".page-header").hasClass("page-header-fixed-mobile")&&(n=$(".page-header").outerHeight(!0)):$(".page-header").hasClass("navbar-fixed-top")&&(n=$(".page-header").outerHeight(!0)),a.fixedHeaderOffset=n,a.tblID=t;var l=e(a);i=o.dataTable(l)}function a(e,a){var o=$(e);if(Data=ReadData(a),$(e+"_TableTitle").text(Data.title),$(e+"_datasource").text("("+Data.source+")"),Data.cols<2)return void infoTips("请确保数据列在2列以上，当前为："+Data.cols);if(!(Data.rows>0))return void infoTips("该时间范围内无质量数据，请重新选择查询时间!",1);if(!$("#sample tbody").length)return void t(e,Data);i=o.dataTable(),i.fnClearTable(this);for(var n=i.fnSettings(),l=0;l<Data.rows;l++)i.oApi._fnAddData(n,Data.data[l]);n.aiDisplay=n.aiDisplayMaster.slice(),i.fnDraw()}var i;return{init:function(){$("#Preview").on("click",function(){var e=$("#PreviewUrl").val();a("#sample",e)}),initApiList.init()},RefreshTable:function(e,t){a(e,t)},newRow:function(e){initApiList.newRow(e)}}}(),FormEditable=function(){$.mockjaxSettings.responseTime=100;var e=function(){$.mockjax({url:"/post"}),$.mockjax({url:"/DBGroups",response:function(){this.responseText=[{value:0,text:"质量综合管理系统"},{value:1,text:"小张核查"},{value:2,text:"码后核查"},{value:3,text:"机台作业"},{value:4,text:"库管系统"}]}})},t=function(){var e=($("#InputToggle").bootstrapSwitch("state")===!0?1:0,$("#InputInner").bootstrapSwitch("state")===!0?1:0);e&&($.fn.editable.defaults.mode="inline"),$.fn.editable.defaults.inputclass="form-control",$.fn.editable.defaults.url="/post",$("#ApiName").editable({validate:function(e){return""===$.trim(e)?"该字段不能为空":void 0},url:"/post",type:"text",pk:1,name:"ApiName",title:"请输入接口名称"}),$("#Token").editable({validate:function(e){return""===$.trim(e)?"该字段不能为空":void 0}}),$("#DataBaseID").editable({name:"DBID",inputclass:"form-control",source:[{value:0,text:"质量综合管理系统"},{value:1,text:"小张核查"},{value:2,text:"码后核查"},{value:3,text:"机台作业"},{value:4,text:"库管系统"},{value:5,text:"质量控制中心"}]}),$("#CreateDate").editable({format:"yyyy-mm-dd hh:ii",viewformat:"yyyy-mm-dd hh:ii",datetimepicker:{rtl:App.isRTL(),todayBtn:"linked",weekStart:1}}),$("#SQL").editable({name:"strSQL",showbuttons:"bottom",rows:8,inputclass:"form-control",tpl:'<textarea style="min-width:430px;"></textarea>',validate:function(e){return""===$.trim(e)?"该字段不能为空":void 0}}),$("#note").editable({showbuttons:App.isRTL()?"left":"right",name:"ApiDesc"}),$("#pencil").on("click",function(e){e.stopPropagation(),e.preventDefault(),$("#note").editable("toggle")}),$("#url").editable({name:"URL",disabled:!0}),$("#ApiID").editable({disabled:!0})};return{init:function(){e(),t(),$("#edit").on("click",function(){$("#user .editable").editable("toggleDisabled"),$("#url").editable("disable"),$("#ApiID").editable("disable")}),$("#InputInner").on("switchChange.bootstrapSwitch",function(){SaveSettings(),window.location.reload()}),$("#user .editable").on("hidden",function(e,t){if("save"===t||"nochange"===t){var a=$(this).closest("tr").next().find(".editable");InputToggle?setTimeout(function(){a.editable("show")},300):a.focus()}}),$("#SaveAPI,#saves").on("click",function(){var e=getRootUrl("DataInterface")+"SaveAPI",t=$("#user .editable").editable("getValue");if(""===t.ApiName||""===t.SQL||""===t.params)return void infoTips("接口名、查询语句以及接口参数不允许为空,请检查后重新提交",1);t.params=$("#params").val().split(",");var a=$("#DataBaseID").text().trim();$.post(e,t,function(e){var i=jQuery.parseJSON(e);if(infoTips(i.message,1),i.status){$("#Reset").click(),$("#ApiID").editable("setValue",i.NewID);var o="&ID="+t.ApiID,n=parseInt(t.ApiID,10)+1,l="&ID="+n,s=t.URL.replace(o,l);$("#url").editable("setValue",s),$("#DemoUrl").text(s),$("#DemoUrl").attr("href",s),t.newID=i.ID,t.AuthorName=$("#AuthorName").text().trim(),t.DBName=a,dataTable.newRow(t)}})}),$("#Reset").on("click",function(){$("#ApiName").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved"),$("#DataBaseID").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved"),$("#SQL").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved");var e='[功能说明]<p style="text-indent:2em;">本接口主要用于 <i>XX</i> 信息的查询.</p>[主要参数]';e+="<ul><li>TimeStart:开始时间；</li><li> TimeEnd:开始时间；</li><li> Cols:1/0,默认为空，设为1时返回查询语句的列用于表格初始化等操作；</li></ul>",$("#note").editable("setValue",e).editable("option","pk",null).removeClass("editable-unsaved")}),$('a[href="#portlet_tab1"]').on("click",function(){$('.portlet[name="api_View"]').hide(),window.onscroll=function(){$('table[aria-describedby="apiList_info"] thead tr[role="row"]:nth(1)').show(),$('table[aria-describedby="sample_info"] thead tr[role="row"]:nth(1)').hide()}}),$('a[href="#portlet_tab2"]').on("click",function(){$('.portlet[name="api_View"]').show(),window.onscroll=function(){$('table[aria-describedby="apiList_info"] thead tr[role="row"]:nth(1)').hide(),$('table[aria-describedby="sample_info"] thead tr[role="row"]:nth(1)').show()}}),$(document).on("blur",".bootstrap-tagsinput",function(){$(this).css({"background-color":$(".bootstrap-tagsinput").parent().css("background-color"),border:"none","box-shadow":"none"})}),$(document).on("focus",".bootstrap-tagsinput",function(){$(".bootstrap-tagsinput").removeAttr("style")})}}}();jQuery(document).ready(function(){RoundedTheme(0),UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),$("#CreateDate").text(today(3)),initDom(),ReadSettings(),dataTable.init(),FormEditable.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=DataInterface.min.js.map