function SaveSettings(){var e=$("#RefreshTime").val(),t=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,a=$("#FixTblHead").bootstrapSwitch("state")===!0?1:0,o=$("#FixTblCol").bootstrapSwitch("state")===!0?1:0,i=$("#FootSearch").bootstrapSwitch("state")===!0?1:0,n=$("#InputToggle").bootstrapSwitch("state")===!0?1:0,l=$("#InputInner").bootstrapSwitch("state")===!0?1:0,s=getRootUrl("QualityTable")+"/SaveSettings";$.post(s,{RefreshTime:e,AutoRefresh:t,FixTblHead:a,FixTblCol:o,FootSearch:i,InputToggle:n,InputInner:l},function(e,t){if("success"==t){var a=jQuery.parseJSON(e);infoTips(a.message,1)}else infoTips("保存设置失败，请稍后重试或联系管理员!",0)})}function ReadSettings(){var e=getRootPath()+"/QualityTable/ReadSettings";$.ajax({type:"POST",async:!1,url:e,success:function(e){var t=jQuery.parseJSON(e),a=t.data[0];$("#RefreshTime").val(a.RefreshTime),0===a.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState"),0===a.FixTblHead&&$("#FixTblHead").bootstrapSwitch("toggleState"),0===a.FixTblCol&&$("#FixTblCol").bootstrapSwitch("toggleState"),0===a.FootSearch&&$("#FootSearch").bootstrapSwitch("toggleState"),0===a.InputToggle&&$("#InputToggle").bootstrapSwitch("toggleState"),0===a.InputInner&&$("#InputInner").bootstrapSwitch("toggleState")}})}$("#HideTips").on("click",function(){$(".note.note-success").hide()}),$("#SaveSettings").on("click",function(){SaveSettings()});var dataTable=function(){function e(e){var t;return t={bRetrieve:!0,language:{url:getRootPath()+"/assets/pages/controller/DataTableLanguage.min.json"},order:[[1,"asc"]],lengthMenu:[[5,10,15,20,50,100,-1],[5,10,15,20,50,100,"All"]],pageLength:15,dom:"<'row tbTools' <'col-md-6 col-sm-12 pull-right'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>>t<'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible"},text:"复制"},{extend:"excelHtml5",exportOptions:{columns:":visible"}},{extend:"csvHtml5",exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:e.cols>10?"landscape":"portrit",pageSize:e.cols>10?"A3":"A4",message:e.source+"\n©成都印钞有限公司 技术质量部",title:e.title,exportOptions:{columns:":visible"}},{extend:"print",autoPrint:!1,text:"打印",message:e.source+"<br>©成都印钞有限公司 技术质量部",title:e.title,exportOptions:{columns:":visible"}},{extend:"colvis",text:'隐藏数据列<i class="fa fa-angle-down"></i>',className:"btn-fit-height green-haze dropdown-toggle"}],bDeferRender:!0,bProcessing:!0,bStateSave:!0,bserverSide:!1,bInfo:!0,bAutoWidth:!0,bSortClasses:!1,aoColumns:e.header,data:e.data,bScrollInfinite:!0,searchHighlight:!0,colReorder:{realtime:!0},fixedHeader:{header:!0,footer:!0,headerOffset:e.fixedHeaderOffset},scroolY:"70v",scrollCollapse:!0,initComplete:function(){var t=this.api();t.$("td").on("click",function(){t.search(this.innerText).draw()}),$(e.tblID+"_tools").append($(e.tblID).parent().find(".tabletools-btn-group").clone(!0)),$(e.tblID).parent().find(".tabletools-btn-group").remove()}}}function t(t,a){var i=$(t),n=0;App.getViewPort().width<App.getResponsiveBreakpoint("md")?$(".page-header").hasClass("page-header-fixed-mobile")&&(n=$(".page-header").outerHeight(!0)):$(".page-header").hasClass("navbar-fixed-top")&&(n=$(".page-header").outerHeight(!0)),a.fixedHeaderOffset=n,a.tblID=t;var l=e(a);o=i.dataTable(l)}function a(e,a){var i=$(e);if(Data=ReadData(a),$(e+"_TableTitle").text(Data.title),$(e+"_datasource").text("("+Data.source+")"),Data.cols<2)return void infoTips("请确保数据列在2列以上，当前为："+Data.cols);if(!(Data.rows>0))return void infoTips("该时间范围内无质量数据，请重新选择查询时间!",1);if(!$("#sample tbody").length)return void t(e,Data);o=i.dataTable(),o.fnClearTable(this);for(var n=o.fnSettings(),l=0;l<Data.rows;l++)o.oApi._fnAddData(n,Data.data[l]);n.aiDisplay=n.aiDisplayMaster.slice(),o.fnDraw()}var o,i=function(){function e(e,t){for(var a=e.fnGetData(t),o=$(">td",t),i=0,n=o.length;n>i;i++)e.fnUpdate(a[i],t,i,!1);e.fnDraw()}function t(e,t){var a=e.fnGetData(t),o=$(">td",t);o[3].innerHTML='<input type="text" class="form-control" value="'+a[3]+'">',o[4].innerHTML='<input type="text" class="form-control input-large" value="'+a[4]+'">',o[5].innerHTML='<input type="text" class="form-control" value="'+a[5]+'">',o[6].innerHTML='<a class="edit" href="javascript:;" data-sn="'+s+'">保存</a>',o[7].innerHTML='<a class="cancel" href="javascript:;" data-sn="'+s+'">取消</a>'}function a(e,t){var a=$("input",t),o={ApiName:a[0].value,strSQL:a[1].value,Params:a[2].value,utf2gbk:[{title:"ApiName"},{title:"strSQL"},{title:"Params"}],id:s,tbl:30};if(""!==o.ApiName&&""!==o.strSQL&&""!==o.Params){e.fnUpdate(a[0].value,t,3,!1),e.fnUpdate(a[1].value,t,4,!1),e.fnUpdate(a[2].value,t,5,!1),e.fnUpdate('<a class="edit" href="javascript:;" data-sn="'+s+'">编辑</a>',t,6,!1),e.fnUpdate('<a class="delete"href="javascript:;" data-sn="'+s+'">删除</a>',t,7,!1),e.fnDraw();var i=getRootPath()+"/DataInterface/update";$.post(i,o,function(e){var t=$.parseJSON(e);infoTips(t.message,t.type)})}else infoTips("相应单元格内容不能为空")}var o=getRootPath(1)+"/DataInterface/Api?Token=0cf7187bf9fa92a76e26aaa380aa532b72247fd5&ID=0&M=3&t="+Math.random(),i=ReadData(o),n=CreateTableBody(i,!0);$("#apiList tbody").html(n),$("#apiList_TableTitle").text(i.title),$("#apiList_datasource").text("("+i.source+")");var l=0;App.getViewPort().width<App.getResponsiveBreakpoint("md")?$(".page-header").hasClass("page-header-fixed-mobile")&&(l=$(".page-header").outerHeight(!0)):$(".page-header").hasClass("navbar-fixed-top")&&(l=$(".page-header").outerHeight(!0));var s,r={bRetrieve:!0,language:{url:getRootPath()+"/assets/pages/controller/DataTableLanguage.min.json"},order:[[1,"asc"]],lengthMenu:[[5,10,15,20,50,100,-1],[5,10,15,20,50,100,"All"]],pageLength:15,dom:"<'row tbTools' <'col-md-6 col-sm-12 pull-right'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>>t<'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible"},text:"复制"},{extend:"excelHtml5",exportOptions:{columns:":visible"}},{extend:"csvHtml5",exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:i.cols>10?"landscape":"portrit",pageSize:i.cols>10?"A3":"A4",message:i.source+"\n©成都印钞有限公司 技术质量部",title:i.title,exportOptions:{columns:":visible"}},{extend:"print",autoPrint:!1,text:"打印",message:i.source+"<br>©成都印钞有限公司 技术质量部",title:i.title,exportOptions:{columns:":visible"}},{extend:"colvis",text:'隐藏数据列<i class="fa fa-angle-down"></i>',className:"btn-fit-height green-haze dropdown-toggle"}],bDeferRender:!0,bProcessing:!0,bStateSave:!0,bserverSide:!1,bInfo:!0,bAutoWidth:!0,bSortClasses:!1,bScrollInfinite:!0,searchHighlight:!0,fixedHeader:{header:!0,footer:!0,headerOffset:l},scroolY:"70v",scrollCollapse:!0,initComplete:function(){$("#apiList_tools").append($("#apiList").parent().find(".tabletools-btn-group").clone(!0)),$("#apiList").parent().find(".tabletools-btn-group").remove()}},d=$("#apiList"),c=d.dataTable(r),p=null;d.on("click",".edit",function(o){s=$(this).attr("data-sn"),o.preventDefault();var i=$(this).parents("tr")[0];null!==p&&p!=i?(e(c,p),t(c,i),p=i):p==i&&"保存"==this.innerHTML?(a(c,p),p=null):(t(c,i),p=i,$(this).text("保存"),$(this).parent().parent().find("a:eq(1)").text("取消"),$(this).parent().parent().find("a:eq(1)").removeClass("delete"),$(this).parent().parent().find("a:eq(1)").addClass("cancel"))}),d.on("click",".delete",function(e){e.preventDefault();var t=$(this);bootbox.dialog({message:"确定删除这条信息?",title:"删除信息",buttons:{success:{label:"删除",className:"green",callback:function(){var e=getRootPath()+"/DataInterface/delete";$.post(e,{id:t.attr("data-sn"),tbl:30},function(){var e=t.parents("tr")[0];c.fnDeleteRow(e),infoTips("数据成功删除",1)})}},main:{label:"取消",className:"red",callback:function(){}}}})}),d.on("click",".cancel",function(t){t.preventDefault(),e(c,p),p=null})};return{init:function(){$("#Preview").on("click",function(){var e=$("#PreviewUrl").val();a("#sample",e)}),i()},RefreshTable:function(e,t){a(e,t)}}}(),FormEditable=function(){$.mockjaxSettings.responseTime=100;var e=function(){$.mockjax({url:"/post"}),$.mockjax({url:"/DBGroups",response:function(){this.responseText=[{value:0,text:"质量综合管理系统"},{value:1,text:"小张核查"},{value:2,text:"码后核查"},{value:3,text:"机台作业"},{value:4,text:"库管系统"}]}})},t=function(){var e=($("#InputToggle").bootstrapSwitch("state")===!0?1:0,$("#InputInner").bootstrapSwitch("state")===!0?1:0);e&&($.fn.editable.defaults.mode="inline"),$.fn.editable.defaults.inputclass="form-control",$.fn.editable.defaults.url="/post",$("#ApiName").editable({validate:function(e){return""===$.trim(e)?"该字段不能为空":void 0},url:"/post",type:"text",pk:1,name:"ApiName",title:"请输入接口名称"}),$("#Token").editable({validate:function(e){return""===$.trim(e)?"该字段不能为空":void 0}}),$("#DataBaseID").editable({name:"DBID",inputclass:"form-control",source:[{value:0,text:"质量综合管理系统"},{value:1,text:"小张核查"},{value:2,text:"码后核查"},{value:3,text:"机台作业"},{value:4,text:"库管系统"},{value:5,text:"质量控制中心"}]}),$("#CreateDate").editable({format:"yyyy-mm-dd hh:ii",viewformat:"yyyy-mm-dd hh:ii",datetimepicker:{rtl:App.isRTL(),todayBtn:"linked",weekStart:1}}),$("#SQL").editable({name:"strSQL",showbuttons:"bottom",rows:8,inputclass:"form-control",tpl:'<textarea style="min-width:430px;"></textarea>',validate:function(e){return""===$.trim(e)?"该字段不能为空":void 0}}),$("#note").editable({showbuttons:App.isRTL()?"left":"right",name:"ApiDesc"}),$("#pencil").on("click",function(e){e.stopPropagation(),e.preventDefault(),$("#note").editable("toggle")}),$("#url").editable({name:"URL",disabled:!0}),$("#ApiID").editable({disabled:!0})};return{init:function(){e(),t(),$("#edit").on("click",function(){$("#user .editable").editable("toggleDisabled"),$("#url").editable("disable"),$("#ApiID").editable("disable")}),$("#InputInner").on("switchChange.bootstrapSwitch",function(){SaveSettings(),window.location.reload()}),$("#user .editable").on("hidden",function(e,t){if("save"===t||"nochange"===t){var a=$(this).closest("tr").next().find(".editable");InputToggle?setTimeout(function(){a.editable("show")},300):a.focus()}}),$("#SaveAPI").on("click",function(){var e=getRootUrl("DataInterface")+"SaveAPI",t=$("#user .editable").editable("getValue");return""===t.ApiName||""===t.SQL||""===t.params?void infoTips("接口名、查询语句以及接口参数不允许为空,请检查后重新提交",1):(t.params=$("#params").val().split(","),void $.post(e,t,function(e){var a=jQuery.parseJSON(e);if(infoTips(a.message,1),a.status){$("#Reset").click(),$("#ApiID").editable("setValue",a.NewID);var o="&ID="+t.ApiID,i=parseInt(t.ApiID,10)+1,n="&ID="+i,l=t.URL.replace(o,n);$("#url").editable("setValue",l),$("#DemoUrl").text(l),$("#DemoUrl").attr("href",l)}}))}),$("#Reset").on("click",function(){$("#ApiName").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved"),$("#DataBaseID").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved"),$("#SQL").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved");var e='[功能说明]<p style="text-indent:2em;">本接口主要用于 <i>XX</i> 信息的查询.</p>[主要参数]';e+="<ul><li>TimeStart:开始时间；</li><li> TimeEnd:开始时间；</li><li> Cols:1/0,默认为空，设为1时返回查询语句的列用于表格初始化等操作；</li></ul>",$("#note").editable("setValue",e).editable("option","pk",null).removeClass("editable-unsaved")}),$('a[href="#portlet_tab1"]').on("click",function(){$('.portlet[name="api_View"]').hide(),window.onscroll=function(){$('table[aria-describedby="apiList_info"] thead tr[role="row"]:nth(1)').show(),$('table[aria-describedby="sample_info"] thead tr[role="row"]:nth(1)').hide()}}),$('a[href="#portlet_tab2"]').on("click",function(){$('.portlet[name="api_View"]').show(),window.onscroll=function(){$('table[aria-describedby="apiList_info"] thead tr[role="row"]:nth(1)').hide(),$('table[aria-describedby="sample_info"] thead tr[role="row"]:nth(1)').show()}}),$(document).on("blur",".bootstrap-tagsinput",function(){$(this).css({"background-color":$(".bootstrap-tagsinput").parent().css("background-color"),border:"none","box-shadow":"none"})}),$(document).on("focus",".bootstrap-tagsinput",function(){$(".bootstrap-tagsinput").removeAttr("style")})}}}();jQuery(document).ready(function(){RoundedTheme(0),UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),$("#CreateDate").text(today(3)),initDom(),ReadSettings(),dataTable.init(),FormEditable.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=DataInterface.min.js.map