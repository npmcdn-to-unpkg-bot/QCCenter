var MicroBlog=function(){function e(){var e=getRootUrl("MicroBlog")+"ReadSettings";$.ajax({type:"POST",async:!1,url:e,success:function(e){var a=jQuery.parseJSON(e),t=a.data[0];$("#LoadingNum").val(t.NumsID),$("#RefreshTime").val(t.RefreshTime),0===t.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState")}})}function a(e){"undefined"==typeof e&&(e=$("#KeyWord").val());var a=[10,20,30,40,50],t=getDateRange(),i={Nums:a[$("#LoadingNum").val()],TimeStart:t.start,TimeEnd:t.end,KeyWord:e,CurID:""!==KeyWord?0:parseInt($("#PostMicriBlog").data("sn"),10),UserName:UTF2GBK($("#PostMicriBlog").data("username"))};0===i.CurID&&$(".timeline").html("");var n=getRootPath()+"/MicroBlog/ReadMicroBlog",o=0;return $.ajax({type:"POST",async:!1,url:n,data:i,success:function(e){var a=jQuery.parseJSON(e);if(a.rows>0){var t='<div class="timeline-item"><div class="timeline-badge">';t+='<div class="timeline-icon"><i class="icon-user font-green-haze"></i></div></div>',t+='<div class="timeline-body"><div class="timeline-body-arrow"></div><div class="timeline-body-head"><div class="timeline-body-head-caption"><a href="#" class="timeline-body-title font-blue-madison">';for(var n,s,l='</a><span class="timeline-body-time font-grey-cascade">发表于',r="</h4></span></div></div></div>",c=a.rows-1;c>=0;c--)s='</small></span></div><div class="timeline-body-head-actions">',s+="<a data-sn="+a.data[c].ID+' class="btn btn-circle red btn-outline btn-block del" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定删除该条日志?" data-btn-ok-label="是" data-btn-ok-icon="icon-trash" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-trash"></i>&nbsp;&nbsp;删除 </a>',s+='</div></div><div class="timeline-body-content"><span class="font-grey-mint"><h4>',n=GBK2UTF(a.data[c].BlogHTML),""!==i.KeyWord&&(n=n.replace(new RegExp(i.KeyWord,"g"),'<span class="caption-subject bold font-yellow-casablanca" style="font-size: 16px; line-height: 18px;">'+i.KeyWord+"</span>")),$(".timeline:first").prepend(t+GBK2UTF(a.data[c].UserName)+l+a.data[c].RecordTime+s+n+r),$(".del").first().confirmation();$("#PostMicriBlog").data("sn",""!==KeyWord?0:a.data[0].ID),o=a.rows}else infoTips("该时间范围内无日志，请重新设置!",0)},error:function(e){infoTips("读取日志出现错误，信息:\n"+JSON.stringify(e))}}),o}$("#SaveSettings").on("click",function(){var e=$("#LoadingNum").val(),a=$("#RefreshTime").val(),t=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,i=getRootUrl("MicroBlog")+"SaveSettings";$.post(i,{NumsID:e,RefreshTime:a,AutoRefresh:t},function(e,a){if("success"==a){var t=jQuery.parseJSON(e);infoTips(t.message,1)}else infoTips("保存设置失败，请稍后重试或联系管理员!",0)})}),$("#PostMicriBlog").on("click",function(){var e=$("#BlogContent").val();if(e.length<=140&&e.length){var a=getRootPath()+"/DataInterface/insert",t={tbl:TBL.MICRO_BLOG,RecordTime:today(1),BlogHTML:UTF2GBK(e),utf2gbk:["BlogHTML","UserName"],UserName:UTF2GBK($("#PostMicriBlog").data("username")),HideBlog:0};$.ajax({type:"POST",async:!1,url:a,data:t,success:function(e){var a=$.parseJSON(e);$("#BlogContent").val(""),$("#WordNum").html("还可以输入140字"),$("#PostMicriBlog").data("sn",a.id);var i='<div class="timeline-item"><div class="timeline-badge">';i+='<div class="timeline-icon"><i class="icon-user font-green-haze"></i></div></div>',i+='<div class="timeline-body"><div class="timeline-body-arrow"></div><div class="timeline-body-head"><div class="timeline-body-head-caption"><a href="#" class="timeline-body-title font-blue-madison">';var n='</a><span class="timeline-body-time font-grey-cascade">发表于',o="</h4></span></div></div></div>",s='</small></span></div><div class="timeline-body-head-actions">';s+="<a data-sn="+a.id+' class="btn btn-circle red btn-outline btn-block del" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定删除该条日志?" data-btn-ok-label="是" data-btn-ok-icon="icon-trash" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-trash"></i>&nbsp;&nbsp;删除 </a>',s+='</div></div><div class="timeline-body-content"><span class="font-grey-mint"><h4>',$(".timeline:first").prepend(i+GBK2UTF(t.UserName)+n+t.RecordTime+s+GBK2UTF(t.BlogHTML)+o),$(".del").first().confirmation()},error:function(e){infoTips("插入数据失败，错误信息:\n"+e)}})}else bsTips("请确认输入字符数在0到140字之间")}),$("#BlogContent").bind("input propertychange",function(){var e=140-$("#BlogContent").val().length;$("#WordNum").html(e>=0?"还可以输入"+e+"字":'已超出<span class="font-red-mint bold">'+-e+"</span>字")});!function(){$(".page-header").on("keypress",".search-form .form-control",function(e){if(13==e.which){$(this).closest(".search-form").removeClass("open"),$("#PostMicriBlog").data("sn",0);var t=a($(this).val());t&&bsTips("查询到"+t+"条记录",1),$(this).val("")}}),$(".page-header").on("mousedown",".search-form.open .submit",function(e){e.preventDefault(),e.stopPropagation(),$(this).closest(".search-form").removeClass("open"),$("#PostMicriBlog").data("sn",0);var t=a($(".search-form .form-control").val());t&&bsTips("查询到"+t+"条记录",1),$(".search-form .form-control").val("")})}();return{init:function(){e(),a(),$("#QueryData").on("click",function(){a()}),$("#dashboard-report-range").on("apply.daterangepicker",function(){$("#PostMicriBlog").data("sn",0),a()}),$("body").on("confirmed.bs.confirmation",".del",function(){var e=getRootPath()+"/DataInterface/update",a=$(this),t={tbl:TBL.MICRO_BLOG,id:a.data("sn"),HideBlog:1};$.post(e,t,function(e,t){"success"==t?(a.parents(".timeline-item").remove(),bsTips("工作笔记删除成功",2)):(bsTips("工作笔记失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(e)))})}),$("body").on("canceled.bs.confirmation","a.del",function(){$("div.popover").parent().find("a.del").click()})}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYY-MM-DD"),initDom(),MicroBlog.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=MicroBlog.min.js.map