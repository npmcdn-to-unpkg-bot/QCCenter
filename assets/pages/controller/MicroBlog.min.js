var MicroBlog=function(){function a(){var a=getRootUrl("MicroBlog")+"ReadSettings";$.ajax({type:"POST",async:!1,url:a,success:function(a){var e=jQuery.parseJSON(a),t=e.data[0];$("#LoadingNum").val(t.NumsID),$("#RefreshTime").val(t.RefreshTime),0===t.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState")}})}function e(){var a="1"==$(".username").data("set-avatar")?$(".username").data("avatar"):"Avatar_none";return getRootPath(1)+"/demo/avatar/"+a+".jpg"}function t(a){"undefined"==typeof a&&(a=$("#KeyWord").val());var e=[10,20,30,40,50],t=getDateRange(),n={Nums:e[$("#LoadingNum").val()],TimeStart:t.start,TimeEnd:t.end,KeyWord:UTF2GBK(a),CurID:""!==KeyWord?0:parseInt($("#PostMicriBlog").data("sn"),10),UserName:UTF2GBK($("#PostMicriBlog").data("username"))};0===n.CurID&&$(".timeline").html("");var o=getRootPath()+"/MicroBlog/ReadMicroBlog",s=0;return $.ajax({type:"POST",async:!1,url:o,data:n,success:function(a){var e=jQuery.parseJSON(a);if(e.rows>0){var t='<div class="timeline-item"><div class="timeline-badge">';t+='<div class="timeline-badge"><img class="timeline-badge-userpic" src="'+i+'"></div></div>',t+='<div class="timeline-body"><div class="timeline-body-arrow"></div><div class="timeline-body-head"><div class="timeline-body-head-caption"><a href="#" class="timeline-body-title font-blue-madison">';for(var o,r,l='</a><span class="timeline-body-time font-grey-cascade">发表于',c="</h4></span></div></div></div>",d=e.rows-1;d>=0;d--)r='</small></span></div><div class="timeline-body-head-actions">',r+="<a data-sn="+e.data[d].ID+' class="btn btn-circle red btn-outline btn-block del" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定删除该条日志?" data-btn-ok-label="是" data-btn-ok-icon="icon-trash" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-trash"></i>&nbsp;&nbsp;删除 </a>',r+='</div></div><div class="timeline-body-content"><span class="font-grey-mint"><h4>',o=GBK2UTF(e.data[d].BlogHTML),""!==n.KeyWord&&(o=o.replace(new RegExp(n.KeyWord,"g"),'<span class="caption-subject bold font-yellow-casablanca" style="font-size: 16px; line-height: 18px;">'+GBK2UTF(n.KeyWord)+"</span>")),$(".timeline:first").prepend(t+GBK2UTF(e.data[d].UserName)+l+e.data[d].RecordTime+r+o+c),$(".del").first().confirmation();$("#PostMicriBlog").data("sn",""!==KeyWord?0:e.data[0].ID),s=e.rows}else infoTips("该时间范围内无日志，请重新设置!",0)},error:function(a){infoTips("读取日志出现错误，信息:\n"+JSON.stringify(a))}}),s}var i=e();$("#SaveSettings").on("click",function(){var a=$("#LoadingNum").val(),e=$("#RefreshTime").val(),t=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,i=getRootUrl("MicroBlog")+"SaveSettings";$.post(i,{NumsID:a,RefreshTime:e,AutoRefresh:t},function(a,e){if("success"==e){var t=jQuery.parseJSON(a);infoTips(t.message,1)}else infoTips("保存设置失败，请稍后重试或联系管理员!",0)})}),$("#PostMicriBlog").on("click",function(){var a=$("#BlogContent").val();if(a.length<=140&&a.length){var e=getRootPath()+"/DataInterface/insert",t={tbl:TBL.MICRO_BLOG,RecordTime:today(1),BlogHTML:UTF2GBK(a),utf2gbk:["BlogHTML","UserName"],UserName:UTF2GBK($("#PostMicriBlog").data("username")),HideBlog:0};$.ajax({type:"POST",async:!1,url:e,data:t,success:function(a){var e=$.parseJSON(a);$("#BlogContent").val(""),$("#WordNum").html("还可以输入140字"),$("#PostMicriBlog").data("sn",e.id);var n='<div class="timeline-item"><div class="timeline-badge">';n+='<div class="timeline-badge"><img class="timeline-badge-userpic" src="'+i+'"></div></div>',n+='<div class="timeline-body"><div class="timeline-body-arrow"></div><div class="timeline-body-head"><div class="timeline-body-head-caption"><a href="#" class="timeline-body-title font-blue-madison">';var o='</a><span class="timeline-body-time font-grey-cascade">发表于',s="</h4></span></div></div></div>",r='</small></span></div><div class="timeline-body-head-actions">';r+="<a data-sn="+e.id+' class="btn btn-circle red btn-outline btn-block del" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定删除该条日志?" data-btn-ok-label="是" data-btn-ok-icon="icon-trash" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-trash"></i>&nbsp;&nbsp;删除 </a>',r+='</div></div><div class="timeline-body-content"><span class="font-grey-mint"><h4>',$(".timeline:first").prepend(n+GBK2UTF(t.UserName)+o+t.RecordTime+r+GBK2UTF(t.BlogHTML)+s),$(".del").first().confirmation()},error:function(a){infoTips("插入数据失败，错误信息:\n"+a)}})}else bsTips("请确认输入字符数在0到140字之间")}),$("#BlogContent").bind("input propertychange",function(){var a=140-$("#BlogContent").val().length;$("#WordNum").html(a>=0?"还可以输入"+a+"字":'已超出<span class="font-red-mint bold">'+-a+"</span>字")});!function(){$(".page-header").on("keypress",".search-form .form-control",function(a){if(13==a.which){$(this).closest(".search-form").removeClass("open"),$("#PostMicriBlog").data("sn",0);var e=t($(this).val());e&&bsTips("查询到"+e+"条记录",1),$(this).val("")}}),$(".page-header").on("mousedown",".search-form.open .submit",function(a){a.preventDefault(),a.stopPropagation(),$(this).closest(".search-form").removeClass("open"),$("#PostMicriBlog").data("sn",0);var e=t($(".search-form .form-control").val());e&&bsTips("查询到"+e+"条记录",1),$(".search-form .form-control").val("")})}();return{init:function(){a(),t(),$("#QueryData").on("click",function(){t()}),$("#dashboard-report-range").on("apply.daterangepicker",function(){$("#PostMicriBlog").data("sn",0),t()}),$("body").on("confirmed.bs.confirmation",".del",function(){var a=getRootPath()+"/DataInterface/update",e=$(this),t={tbl:TBL.MICRO_BLOG,id:e.data("sn"),HideBlog:1};$.post(a,t,function(a,t){"success"==t?(e.parents(".timeline-item").remove(),bsTips("工作笔记删除成功",2)):(bsTips("工作笔记失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(a)))})}),$("body").on("canceled.bs.confirmation","a.del",function(){$("div.popover").parent().find("a.del").click()})}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYY-MM-DD"),initDom(),MicroBlog.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=MicroBlog.min.js.map