var WorkLogInit=function(){function e(){var e=getRootPath(1)+"/assets/pages/controller/data/worklog_settings.json";$.get(e,function(e){i=e})}function a(e,a){var t='<div class="timeline-item"><div class="timeline-badge">';t+='<div class="timeline-icon"><i class="icon-user font-green-haze"></i></div></div>',t+='<div class="timeline-body"><div class="timeline-body-arrow"></div><div class="timeline-body-head"><div class="timeline-body-head-caption"><a href="#" class="timeline-body-title font-blue-madison">';var n,o,s,r,c='</a><span class="timeline-body-time font-grey-cascade">发表于'+e.rec_time+' <span class="badge badge-round badge-success">'+e.ClassName+"</span></small>";return o=GBK2UTF(e.ErrDesc),""!==a&&(o=o.replace(new RegExp(a,"g"),'<span class="caption-subject bold font-yellow-casablanca" style="font-size: 16px; line-height: 18px;">'+a+"</span>")),r=e.oper_name.split(","),s=e.proStatus_id<4?"btn-success":"btn-danger",0===e.proc_id?(e.machineName=i.paper.machine[e.machine_id],e.productName=i.paper.product[e.prod_id]):(e.machineName=i.banknote.machine[e.machine_id],e.productName=i.banknote.product[e.prod_id]),-1==e.machine_id&&(e.machineName="无"),-1==e.prod_id&&(e.productName="无"),n='</span></div><div class="timeline-body-head-actions"><div class="btn-group"><button class="btn btn-circle '+s+' btn-sm dropdown-toggle" type="button" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">操作 <i class="fa fa-angle-down"></i></button><ul class="dropdown-menu pull-right" role="menu" data-sn='+e.ID+'><li><a href="'+getRootPath(0)+"/worklog/editlog?ID="+e.ID+'"><i class="icon-pencil"></i>&nbsp;&nbsp;编辑 </a></li>',n+="<li><a data-sn="+e.ID+' class="del" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定删除该条日志?" data-btn-ok-label="是" data-btn-ok-icon="icon-trash" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-trash"></i>&nbsp;&nbsp;删除 </a></li>',e.proStatus_id>3&&(n+='<li class="divider"></li><li><a data-sn='+e.ID+' class="complete" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定标记为已完成?" data-btn-ok-label="是" data-btn-ok-icon="icon-check" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-check"></i>&nbsp;&nbsp;标记为已完成 </a></li>'),n+='</ul></div></div></div><div class="timeline-body-content"><span class="font-grey-mint">'+o+"</span>",n+='<hr><div class="col-md-6 font-grey-cascade">问题描述：<span>'+e.MainErrDesc+"/"+e.SubErrDesc+"</span></div>",n+='<div class="col-md-6 font-grey-cascade">操作人员：<span>'+r+"</span></div>",n+='<div class="col-md-6 font-grey-cascade">机台：<span data-sn="'+e.machine_id+'">'+e.machineName+"</span></div>",n+='<div class="col-md-6 font-grey-cascade">品种：<span data-sn="'+e.prod_id+'">'+e.productName+"</span></div>",n+='<div class="col-md-6 font-grey-cascade">相关车号：<span data-sn="'+e.prod_id+'">'+e.prod_info+"</span></div>",n+='<div class="col-md-6 font-grey-cascade">处理结果：<span data-sn="'+e.prod_id+'">'+e.StatusName+"</span></div>",n+="</div></div></div></div>",t+e.rec_user_name+c+n}function t(e){"undefined"==typeof e&&(e=$("#KeyWord").val());var t=getDateRange(),n=getRootUrl("worklog")+"QueryLogInfo",i={proc_id:$("#proc_id").val(),Status:$("#ProStatus").val(),KeyWord:UTF2GBK(e),TimeStart:t.start,TimeEnd:t.end,icurID:$(".timeline-item").length?$(".timeline-item ul").data("sn"):0};0===$(".timeline-item ul").data("sn")&&$(".timeline").html(""),$.post(n,i,function(t){var n=jQuery.parseJSON(t);if(n.rows>0)for(var i=n.rows-1;i>=0;i--)$(".timeline:first").prepend(a(n.data[i],e)),$("a.del").first().confirmation(),$("a.complete").first().confirmation()})}function n(){var e=getRootUrl("worklog")+"ReadLogQuerySettings";$.ajax({type:"POST",async:!1,url:e,success:function(e){var a=jQuery.parseJSON(e),t=a.data[0];$("#proc_id").val(t.ProcID),$("#ProStatus").val(3),$("#RefreshTime").val(t.RefreshTime),0===t.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState")}})}var i;return{init:function(){n(),t(),e(),$("#QueryData").on("click",function(){$(".timeline-item ul").data("sn",0),t()}),$(document).on("confirmed.bs.confirmation","a.del",function(){var e=getRootPath()+"/DataInterface/update",a=$(this),t={tbl:TBL.WORK_LOG,id:a.data("sn"),HideLog:1};$.post(e,t,function(e,t){"success"==t?(a.parents(".timeline-item").remove(),bsTips("日志删除成功",2)):(bsTips("删除失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(e)))})}),$(document).on("confirmed.bs.confirmation","a.complete",function(){var e=getRootPath()+"/DataInterface/update",a=$(this),t={tbl:TBL.WORK_LOG,id:a.data("sn"),proStatus_id:1};$.post(e,t,function(e,t){"success"==t?(a.parents(".btn-group").find(".dropdown-toggle").removeClass("btn-danger"),a.parents(".btn-group").find(".dropdown-toggle").addClass("btn-success"),a.parent().parent().find(".divider").remove(),a.parent().remove(),bsTips("日志状态修改成功",2)):(bsTips("日志状态修改失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(e)))})}),$("#SaveSettings").on("click",function(){var e=$("#proc_id").val(),a=$("#RefreshTime").val(),t=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,n=getRootUrl("worklog")+"SaveLogQuerySettings";$.ajax({type:"POST",async:!1,url:n,data:{ProcID:e,RefreshTime:a,AutoRefresh:t},success:function(e){var a=jQuery.parseJSON(e);infoTips(a.message,1)},error:function(e){infoTips("保存设置失败，请稍后重试或联系管理员!<br>错误提示:"+JSON.stringify(e),0)}})}),$("#dashboard-report-range").on("apply.daterangepicker",function(){$(".timeline-item ul").data("sn",0),t()}),$("#AutoRefresh").bootstrapSwitch("onSwitchChange",function(){$("#AutoRefresh").bootstrapSwitch("state")===!0?("0"==$("#RefreshTime").val()&&$("#RefreshTime").val(600),AutoRefresh(t(),$("#RefreshTime").val())):($("#RefreshTime").val(0),StopRefresh())});!function(){$(".page-header").on("keypress",".search-form .form-control",function(e){if(13==e.which){$(this).closest(".search-form").removeClass("open"),$(".timeline-item ul").data("sn",0);var a=t($(this).val());a&&bsTips("查询到"+a+"条记录",1),$(this).val("")}}),$("body").on("canceled.bs.confirmation","a.del",function(){$("div.popover").parent().find("a.del").click()}),$(".page-header").on("mousedown",".search-form.open .submit",function(e){e.preventDefault(),e.stopPropagation(),$(this).closest(".search-form").removeClass("open"),$(".timeline-item ul").data("sn",0);var a=t($(".search-form .form-control").val());a&&bsTips("查询到"+a+"条记录",1),$(".search-form .form-control").val("")})}()}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYY-MM-DD"),initDom(),WorkLogInit.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=WorkLog.min.js.map