var WorkLogInit=function(){function a(){var a=getRootPath(1)+"/assets/pages/controller/data/worklog_settings.json";$.get(a,function(a){o=a})}function e(a){var e="1"==a.set_avatar?$.base64.encode(a.avatarUrl):"Avatar_none";return getRootPath(1)+"/demo/avatar/"+e+".jpg"}function t(a,t){var n='<div class="timeline-item"><div class="timeline-badge">';n+='<div class="timeline-badge"><img class="timeline-badge-userpic" src="'+e(a)+'"></div></div>',n+='<div class="timeline-body"><div class="timeline-body-arrow"></div><div class="timeline-body-head"><div class="timeline-body-head-caption"><a href="#" class="timeline-body-title font-blue-madison">';var i,s,r,c,d='</a><span class="timeline-body-time font-grey-cascade">发表于'+a.rec_time+' <span class="badge badge-round badge-success">'+a.ClassName+"</span></small>";return s=GBK2UTF(a.ErrDesc),""!==t&&(s=s.replace(new RegExp(t,"g"),'<span class="caption-subject bold font-yellow-casablanca" style="font-size: 16px; line-height: 18px;">'+t+"</span>")),c=a.oper_name.split(","),r=a.proStatus_id<4?"btn-success":"btn-danger",0===a.proc_id?(a.machineName=o.paper.machine[a.machine_id],a.productName=o.paper.product[a.prod_id]):(a.machineName=o.banknote.machine[a.machine_id],a.productName=o.banknote.product[a.prod_id]),-1==a.machine_id&&(a.machineName="无"),-1==a.prod_id&&(a.productName="无"),i='</span></div><div class="timeline-body-head-actions"><div class="btn-group"><button class="btn btn-circle " + statusClass + " btn-sm dropdown-toggle" type="button" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">操作 <i class="fa fa-angle-down"></i></button><ul class="dropdown-menu pull-right" role="menu" data-sn=" + data.ID + "><li><a href="'+getRootPath(0)+"/worklog/editlog?ID="+a.ID+'"><i class="icon-pencil"></i>&nbsp;&nbsp;编辑 </a></li>',i+="<li><a data-sn="+a.ID+' class="del" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定删除该条日志?" data-btn-ok-label="是" data-btn-ok-icon="icon-trash" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-trash"></i>&nbsp;&nbsp;删除 </a></li>',a.proStatus_id>3&&(i+='<li class="divider"></li><li><a data-sn='+a.ID+' class="complete" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定标记为已完成?" data-btn-ok-label="是" data-btn-ok-icon="icon-check" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-check"></i>&nbsp;&nbsp;标记为已完成 </a></li>'),i+='</ul></div></div></div><div class="timeline-body-content"><span class="font-grey-mint">'+s+"</span><hr>",i+='<div class="col-md-6 font-grey-cascade">相关车号：<span data-sn="'+a.prod_id+'">'+a.prod_info+"</span></div>",i+='<div class="col-md-6 font-grey-cascade">品种：<span data-sn="'+a.prod_id+'">'+a.productName+"</span></div>",i+='<div class="col-md-6 font-grey-cascade">机台：<span data-sn="'+a.machine_id+'">'+a.machineName+"</span></div>",i+='<div class="col-md-6 font-grey-cascade">处理结果：<span data-sn="'+a.prod_id+'">'+a.StatusName+"</span></div>",i+='<div class="col-md-6 font-grey-cascade">操作人员：<span>'+c+"</span></div>",i+="</div></div></div></div>",n+a.rec_user_name+d+i}function n(a){"undefined"==typeof a&&(a=$("#KeyWord").val());var e=getDateRange(),n=getRootUrl("worklog")+"QueryLogInfo",i={proc_id:$("#proc_id").val(),Status:$("#ProStatus").val(),KeyWord:UTF2GBK(a),TimeStart:e.start,TimeEnd:e.end,icurID:$(".timeline-item").length?$(".timeline-item ul").data("sn"):0};0===$(".timeline-item ul").data("sn")&&$(".timeline").html(""),$.post(n,i,function(e,n){var i=jQuery.parseJSON(e);if(i.rows>0)for(var o=i.rows-1;o>=0;o--)$(".timeline:first").prepend(t(i.data[o],a)),$("a.del").first().confirmation(),$("a.complete").first().confirmation()})}function i(){var a=getRootUrl("worklog")+"ReadLogQuerySettings";$.ajax({type:"POST",async:!1,url:a,success:function(a){var e=jQuery.parseJSON(a),t=e.data[0];$("#proc_id").val(t.ProcID),$("#ProStatus").val(3),$("#RefreshTime").val(t.RefreshTime),0===t.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState")}})}var o;return{init:function(){i(),n(),a(),$("#QueryData").on("click",function(){$(".timeline-item ul").data("sn",0),n()}),$(document).on("confirmed.bs.confirmation","a.del",function(){var a=getRootPath()+"/DataInterface/update",e=$(this),t={tbl:TBL.WORK_LOG,id:e.data("sn"),HideLog:1};$.post(a,t,function(a,t){"success"==t?(e.parents(".timeline-item").remove(),bsTips("日志删除成功",2)):(bsTips("删除失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(a)))})}),$(document).on("confirmed.bs.confirmation","a.complete",function(){var a=getRootPath()+"/DataInterface/update",e=$(this),t={tbl:TBL.WORK_LOG,id:e.data("sn"),proStatus_id:1};$.post(a,t,function(a,t){"success"==t?(e.parents(".btn-group").find(".dropdown-toggle").removeClass("btn-danger"),e.parents(".btn-group").find(".dropdown-toggle").addClass("btn-success"),e.parent().parent().find(".divider").remove(),e.parent().remove(),bsTips("日志状态修改成功",2)):(bsTips("日志状态修改失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(a)))})}),$("#SaveSettings").on("click",function(){var a=$("#proc_id").val(),e=$("#RefreshTime").val(),t=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,n=getRootUrl("worklog")+"SaveLogQuerySettings";$.ajax({type:"POST",async:!1,url:n,data:{ProcID:a,RefreshTime:e,AutoRefresh:t},success:function(a){var e=jQuery.parseJSON(a);bsTips(e.message,1)},error:function(a){infoTips("保存设置失败，请稍后重试或联系管理员!<br>错误提示:"+JSON.stringify(a),0)}})}),$("#dashboard-report-range").on("apply.daterangepicker",function(){$(".timeline-item ul").data("sn",0),n()}),$("#AutoRefresh").bootstrapSwitch("onSwitchChange",function(){$("#AutoRefresh").bootstrapSwitch("state")===!0?("0"==$("#RefreshTime").val()&&$("#RefreshTime").val(600),AutoRefresh(n(),$("#RefreshTime").val())):($("#RefreshTime").val(0),StopRefresh())});(function(){$(".page-header").on("keypress",".search-form .form-control",function(a){if(13==a.which){$(this).closest(".search-form").removeClass("open"),$(".timeline-item ul").data("sn",0);var e=n($(this).val());e&&bsTips("查询到"+e+"条记录",1),$(this).val("")}}),$("body").on("canceled.bs.confirmation","a.del",function(){$("div.popover").parent().find("a.del").click()}),$(".page-header").on("mousedown",".search-form.open .submit",function(a){a.preventDefault(),a.stopPropagation(),$(this).closest(".search-form").removeClass("open"),$(".timeline-item ul").data("sn",0);var e=n($(".search-form .form-control").val());e&&bsTips("查询到"+e+"条记录",1),$(".search-form .form-control").val("")})})()}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYY-MM-DD"),initDom(),WorkLogInit.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=WorkLog.min.js.map