var WorkLogInit=function(){function a(){var a=getRootPath(1)+"/assets/pages/controller/data/worklog_settings.json";$.get(a,function(a){s=a})}function t(a,t){var e,n,i,o,c='<div class="timeline-item"><div class="timeline-badge"><div class="timeline-badge"><img class="timeline-badge-userpic" src="'+getRootPath(0)+'/assets/pages/media/users/realeve.jpg"></div></div><div class="timeline-body"><div class="timeline-body-arrow"></div><div class="timeline-body-head"><div class="timeline-body-head-caption"><a href="#" class="timeline-body-title font-blue-madison">',d='</a><span class="timeline-body-time font-grey-cascade">发表于'+a.rec_time+' <span class="badge badge-round badge-success">'+a.ClassName+"</span></small>";return n=GBK2UTF(a.ErrDesc),""!==t&&(n=n.replace(new RegExp(t,"g"),'<span class="caption-subject bold font-yellow-casablanca" style="font-size: 16px; line-height: 18px;">'+t+"</span>")),o=a.oper_name.split(","),i=a.proStatus_id<4?"btn-success":"btn-danger",0===a.proc_id?(a.machineName=s.paper.machine[a.machine_id],a.productName=s.paper.product[a.prod_id]):(a.machineName=s.banknote.machine[a.machine_id],a.productName=s.banknote.product[a.prod_id]),e='</span></div><div class="timeline-body-head-actions"><div class="btn-group"><button class="btn btn-circle '+i+' btn-sm dropdown-toggle" type="button" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">操作 <i class="fa fa-angle-down"></i></button><ul class="dropdown-menu pull-right" role="menu" data-sn='+a.ID+'><li><a href="'+getRootPath(0)+"/worklog/editlog?ID="+a.ID+'"><i class="icon-pencil"></i>&nbsp;&nbsp;编辑 </a></li>',e+="<li><a data-sn="+a.ID+' class="del" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定删除该条日志?" data-btn-ok-label="是" data-btn-ok-icon="icon-trash" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-trash"></i>&nbsp;&nbsp;删除 </a></li>',a.proStatus_id>3&&(e+='<li class="divider"></li><li><a data-sn='+a.ID+' class="complete" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="确定标记为已完成?" data-btn-ok-label="是" data-btn-ok-icon="icon-check" data-btn-ok-class="btn-success" data-btn-cancel-label="取消" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-check"></i>&nbsp;&nbsp;标记为已完成 </a></li>'),e+='</ul></div></div></div><div class="timeline-body-content"><span class="font-grey-cascade">'+n+"</span>",e+='<hr><div class="col-md-6 font-grey-cascade">问题描述：<span>'+a.MainErrDesc+"/"+a.SubErrDesc+"</span></div>",e+='<div class="col-md-6 font-grey-cascade">操作人员：<span>'+o+"</span></div>",e+='<div class="col-md-6 font-grey-cascade">机台：<span data-sn="'+a.machine_id+'">'+a.machineName+"</span></div>",e+='<div class="col-md-6 font-grey-cascade">品种：<span data-sn="'+a.prod_id+'">'+a.productName+"</span></div>",e+='<div class="col-md-6 font-grey-cascade">相关车号：<span data-sn="'+a.prod_id+'">'+a.prod_info+"</span></div>",e+='<div class="col-md-6 font-grey-cascade">处理结果：<span data-sn="'+a.prod_id+'">'+a.StatusName+"</span></div>",e+="</div></div></div></div>",c+a.rec_user_name+d+e}function e(){var a=$("#dashboard-report-range span").html(),e=getRootUrl("worklog")+"QueryLogInfo",n=$("#KeyWord").val(),s={proc_id:$("#proc_id").val(),Status:$("#ProStatus").val(),KeyWord:UTF2GBK(n),TimeStart:a.split(" ~ ")[0],TimeEnd:a.split(" ~ ")[1],icurID:$(".timeline-item").length?$(".timeline-item ul").attr("data-sn"):0};$.post(e,s,function(a,e){var s=jQuery.parseJSON(a);if(s.rows>0){bsTips("共查询出"+s.rows+"条数据",1);for(var i=s.rows-1;i>=0;i--)$(".timeline:first").prepend(t(s.data[i],n)),$("a.del").first().confirmation(),$("a.complete").first().confirmation()}else bsTips("该搜索条件范围内无日志，请重新设置!</br>错误信息："+e+"</br>返回值:"+a,1)})}function n(){var a=getRootUrl("worklog")+"ReadLogQuerySettings";$.ajax({type:"POST",async:!1,url:a,success:function(a){var t=jQuery.parseJSON(a),e=t.data[0];$("#proc_id").val(e.ProcID),$("#ProStatus").val(e.Status),$("#RefreshTime").val(e.RefreshTime),0===e.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState")}})}var s;return{init:function(){n(),e(),a(),$("#QueryData").on("click",function(){$(".timeline").html(""),e()}),$(document).on("confirmed.bs.confirmation","a.del",function(){var a=getRootPath()+"/DataInterface/update",t=$(this),e={tbl:25,id:t.attr("data-sn"),HideLog:1};$.post(a,e,function(a,e){"success"==e?(t.parents(".timeline-item").remove(),bsTips("日志删除成功",2)):(bsTips("删除失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(a)))})}),$(document).on("confirmed.bs.confirmation","a.complete",function(){var a=getRootPath()+"/DataInterface/update",t=$(this),e={tbl:25,id:t.attr("data-sn"),proStatus_id:1};$.post(a,e,function(a,e){"success"==e?(t.parents(".btn-group").find(".dropdown-toggle").removeClass("btn-danger"),t.parents(".btn-group").find(".dropdown-toggle").addClass("btn-success"),t.parent().parent().find(".divider").remove(),t.parent().remove(),bsTips("日志状态修改成功",2)):(bsTips("日志状态修改失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(a)))})}),$("#SaveSettings").on("click",function(){var a=$("#proc_id").val(),t=$("#ProStatus").val(),e=$("#RefreshTime").val(),n=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,s=getRootUrl("worklog")+"SaveLogQuerySettings";$.post(s,{ProcID:a,Status:t,RefreshTime:e,AutoRefresh:n},function(a,t){if("success"==t){var e=jQuery.parseJSON(a);infoTips(e.message,1)}else infoTips("保存设置失败，请稍后重试或联系管理员!",0)})}),$("#dashboard-report-range").on("apply.daterangepicker",function(){$(".timeline").html(""),e()})}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYY-MM-DD"),initDom(),WorkLogInit.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=WorkLog.min.js.map