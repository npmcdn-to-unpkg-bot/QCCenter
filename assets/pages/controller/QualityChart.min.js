function SaveSettings(){var e=$("#RefreshTime").val(),t=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,a=$("#FixTblHead").bootstrapSwitch("state")===!0?1:0,i=$("#FixTblCol").bootstrapSwitch("state")===!0?1:0,r=$("#FootSearch").bootstrapSwitch("state")===!0?1:0,s=$("#InputToggle").bootstrapSwitch("state")===!0?1:0,n=$("#InputInner").bootstrapSwitch("state")===!0?1:0,o=getRootUrl("QualityTable")+"/SaveSettings";$.post(o,{RefreshTime:e,AutoRefresh:t,FixTblHead:a,FixTblCol:i,FootSearch:r,InputToggle:s,InputInner:n},function(e,t){if("success"==t){var a=jQuery.parseJSON(e);infoTips(a.message,1)}else infoTips("保存设置失败，请稍后重试或联系管理员!",0)})}function ReadSettings(){var e=getRootUrl("QualityTable")+"/ReadSettings";$.ajax({type:"POST",async:!1,url:e,success:function(e){var t=jQuery.parseJSON(e),a=t.data[0];$("#RefreshTime").val(a.RefreshTime),0===a.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState"),0===a.FixTblHead&&$("#FixTblHead").bootstrapSwitch("toggleState"),0===a.FixTblCol&&$("#FixTblCol").bootstrapSwitch("toggleState"),0===a.FootSearch&&$("#FootSearch").bootstrapSwitch("toggleState")}})}function GetJsonUrl(e){var t=$("#dashboard-report-range span").html(),a=t.split(" ~ ")[0],i=t.split(" ~ ")[1],r=getRootPath()+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&chartType=bar&ID="+e+"&M=3&tstart="+a+"&tend="+i+"&t="+Math.random();return r}function UniqueData(e){e.sort();for(var t=[e[0]],a=1;a<e.length;a++)e[a]!=t[t.length-1]&&t.push(e[a]);return t}function GetRequestParam(e){var t={};if(-1!=e.indexOf("?")){var a=e.substr(1);strs=a.split("&");for(var i=0;i<strs.length;i++)t[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}return t}function GetChartData(e){var t,a,i,r,s=[],n=GetRequestParam(e),o=n.chartType;if(t=ReadData(e),s.title=t.title,s.subTitle=t.source,s.rows=t.rows,infoTips(JSON.stringify(t),2),0===t.rows)return s;if(3==t.cols){for(s.xAxisTitle=t.header[1].title,s.yAxisTitle=t.header[2].title,arrTemp=[],i=0;i<t.rows;i++)arrTemp[i]=t.data[i][0];for(arrTemp.sort(),s.legend=UniqueData(arrTemp),arrTemp=[],i=0;i<t.rows;i++)arrTemp[i]=t.data[i][1];for(s.xAxis=UniqueData(arrTemp),s.yAxis=[],i=0;i<s.legend.length;i++)s.yAxis[s.legend[i]]=[];for(i=0;i<s.legend.length;i++)for(r=0;r<s.xAxis.length;r++)s.yAxis[s.legend[i]][r]="-";for(i=0;i<t.rows;i++)for(a=t.data[i][0],r=0;r<s.xAxis.length;r++)if(t.data[i][1]==s.xAxis[r]){s.yAxis[a][r]=parseFloat(t.data[i][2]);break}for(s.series=[],i=0;i<s.legend.length;i++)s.series[i]={},s.series[i].name=s.legend[i],s.series[i].type=o,s.series[i].smooth=!1,s.series[i].barMaxWidth=100,s.series[i].data=s.yAxis[s.legend[i]],s.series[i].markPoint=MPtStyle,s.series[i].markLine=MLnStyle,s.series[i].itemStyle=dataStyle_iT}else if(2==t.cols){for(s.xAxisTitle=t.header[0].title,s.yAxisTitle=t.header[1].title,arrTemp=[],i=0;i<t.rows;i++)arrTemp[i]=t.data[i][0];for(s.xAxis=UniqueData(arrTemp),s.yAxis=[],i=0;i<s.xAxis.length;i++)s.yAxis[i]="-";for(i=0;i<t.rows;i++)s.yAxis[i]=parseFloat(t.data[i][1]);s.legend=[],s.legend[0]=s.yAxisTitle,s.series=[],s.series[0]={},s.series[0].name=s.yAxisTitle,s.series[0].type=o,s.series[0].smooth=!1,s.series[0].barMaxWidth=100,s.series[0].data=s.yAxis,s.series[0].markPoint=MPtStyle,s.series[0].markLine=MLnStyle,s.series[0].itemStyle=dataStyle_iT}else if(1==t.cols){for(s.xAxisTitle="数据编号",s.yAxisTitle=t.header[0].title,s.legend=[],s.legend[0]=s.yAxisTitle,arrTemp=[],i=0;i<t.rows;i++)arrTemp[i]=i+1;for(s.xAxis=arrTemp,s.yAxis=[],i=0;i<t.rows;i++)s.yAxis[i]=parseFloat(t.data[i][0]);s.series=[],s.series[0]={},s.series[0].name=s.yAxisTitle,s.series[0].type=o,s.series[0].smooth=!1,s.series[0].barMaxWidth=100,s.series[0].data=s.yAxis,s.series[0].markPoint=MPtStyle,s.series[0].markLine=MLnStyle,s.series[0].itemStyle=dataStyle_iT}return s}$("#HideTips").on("click",function(){$(".note.note-success").addClass("hide")}),$("#SaveSettings").on("click",function(){SaveSettings()});var mECharts=function(){function e(){require(["echarts","echarts/chart/line","echarts/chart/bar","echarts/chart/scatter","echarts/chart/pie","echarts/chart/radar","echarts/chart/gauge","echarts/chart/treemap","echarts/chart/map","echarts/chart/tree","echarts/chart/wordCloud"],function(e){h=e,require(["theme/real2"],function(e){p=e,t(),a(p)})})}function t(){var e=$(".portlet-body.form");for(i=0;i<u;i++){var t='<div id="eChart-main'+i+'" optionKey="Line" class="eCharts-main margin-top-10"></div>';e.append(t)}var a=$(".eCharts-main"),r=e.width();a.css("width",r),a.css("height",r/(1==a.length?2:3))}function a(e,t){if(h){var a,i;for(a=0;u>a;a++)chartID="eChart-main"+a,"undefined"==typeof t&&(t=GetJsonUrl(a+17)),i=r(t),i!==!1?(d[a]=h.init(document.getElementById("eChart-main"+a),e),d[a].setOption(i)):infoTips("第"+(a+1)+"张图表无数据，请重新选择查询时间",2);n()}}function r(e){var t=GetChartData(e);if(0===t.rows)return!1;var a={title:{text:t.title,subtext:t.subTitle,x:"center"},tooltip:{trigger:"axis"},legend:{data:t.legend,x:"center",y:70,itemGap:20,textStyle:{fontSize:16},show:t.legend.length<=1?!1:!0},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},dataZoom:{show:!0},magicType:{show:!0,type:["line","bar","stack","tiled"]},restore:{show:!0},saveAsImage:{show:!0}}},dataZoom:{show:t.rows<=12?!1:!0,realtime:!0,start:0,end:100},calculable:!0,xAxis:[{name:t.xAxisTitle,axisTick:{show:!1},type:"category",boundaryGap:!0,data:t.xAxis}],yAxis:[{name:t.yAxisTitle,type:"value",position:"left",scale:!0,axisLabel:{show:!0,interval:"auto",margin:8}}],series:t.series};return a}function s(){if($(".actions select opotion").length)return!1;var e=$(".actions select");e.html('<option name="default">default</option><option name="real2" selected="true" >real2</option><option name="real">real</option><option name="macarons">macarons</option><option name="helianthus">helianthus</option><option name="infographic">infographic</option><option name="shine">shine</option><option name="dark">dark</option><option name="blue">blue</option><option name="green">green</option><option name="red">red</option><option name="gray">gray</option><option name="roma">roma</option><option name="macarons2">macarons2</option><option name="sakura">sakura</option>'),$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),$("select.bs-select").hide()}function n(){return"undefined"==typeof $("#eChart-main0").attr("_echarts_instance_")?!1:void(3==u&&"undefined"!=typeof $("#eChart-main2").attr("_echarts_instance_")?(d[0].connect([d[1],d[2]]),d[1].connect([d[0],d[2]]),d[2].connect([d[0],d[1]])):2==u&&"undefined"!=typeof $("#eChart-main1").attr("_echarts_instance_")&&d[0].connect([d[1]]))}function o(e){var t=e;d[0].showLoading(),require(["theme/"+t],function(e){p=e,setTimeout(l(),500)})}function l(){for(i=0;i<u;i++)d[i].hideLoading(),d[i].setTheme(p)}function c(){var e=$(".actions select");e&&$(e).change(function(){o($(this).val())})}var h,p,u,d=[];return u=1,require.config({paths:{echarts:"assets/global/plugins/echarts/js",theme:"assets/global/plugins/echarts/theme"}}),$(document).on("click",".ranges li:not(:last),button.applyBtn",function(){var e;e=$(".actions select"),require(["theme/"+e.val()],function(e){p=e,setTimeout(a(p),500)})}),$("#Preview").on("click",function(){var e=$("#PreviewUrl").val(),t=$(".actions select");require(["theme/"+t.val()],function(t){p=t,setTimeout(a(p,e+"&chartType=line"),500)})}),{init:function(){s(),e(),c()}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),initDom(),ReadSettings(),mECharts.init(),$.fn.select2.defaults.set("theme","bootstrap")}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=QualityChart.min.js.map