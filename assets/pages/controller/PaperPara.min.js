var PaperParam=function(){function e(){$('form input[type="text"]').eq(0).focus()}function t(){var t=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=24&M=3&t=1",a=ReadData(t);InitSelect("Prod_id",a),t=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=23&M=3&t=1",a=ReadData(t),InitSelect("machine_id",a),t=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=25&M=3&t=1",a=ReadData(t),InitSelect("oper_id",a),$("input[name='rec_date']").val(today(6)),$("input[name='Reel_Code']").maxlength({limitReachedClass:"label label-danger",threshold:3}),initSelect2(),$(".page-header .dropdown-quick-sidebar-toggler").hide(),e(),c="",p=""}function a(){var e=(new Date).getHours();e>=0&&8>e?SetiCheckChecked("class_id",2):e>=8&&16>e?SetiCheckChecked("class_id",0):SetiCheckChecked("class_id",1)}function n(){return""===$('select[name="oper_id"]').val()||""===$('select[name="prod_ID"]').val()||""===$('select[name="machine_ID"]').val()?($(".portlet.light").hide(),1):($(".portlet.light").show(),0)}function i(){var e=$('select[name="Prod_id"]').val()+$('input[name="Reel_Code"]').val(),t=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=33&M=0&r="+e,a=ReadData(t);"0"!==a.rows&&($('input[name="Reel_Code"]').data("reelcode",e),a.header.map(function(e){var t=e.title;$('form .form-control[name="'+t+'"]').val(a.data[0][t])}),SetSelect2Val("oper_id",a.data[0].oper_id),SetSelect2Val("Prod_id",a.data[0].Prod_id),SetSelect2Val("machine_id",a.data[0].machine_id),SetiCheckChecked("class_id",a.data[0].class_id),$('.portlet button[type="submit"]').data("sn",a.data[0].ID),$('.portlet button[type="submit"]').html($('.portlet button[type="submit"]').html().replace("提交","更新")),$(".portlet.light").show(),r(),$(".amounts h4").html("<strong>评价总分:</strong> "+a.data[0].score),$("#checkbox2").iCheck("uncheck"),$(".normalPara input").attr("disabled","true"),$(".normalParaEdit").show())}function r(){var e=$("input[name='rec_date']").val();e=e.substr(0,4)+e.substr(5,2);var t=$('select[name="Prod_id"]').val(),a=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=27&M=3&tmonth="+e+"&prod="+t,n=ReadData(a);a=getRootPath(1)+"/DataInterface/Api?Token=79d84495ca776ccb523114a2120e273ca80b315b&ID=28&M=3&tmonth="+e+"&prod="+t;var i=ReadData(a);$(".grey-cascade").html("物理指标："+xround(n.data[0][0],2)+"，外观指标："+xround(i.data[0][0],2)+"，总分："+xround(parseFloat(n.data[0][0])+parseFloat(i.data[0][0])-100,2))}function o(e,t,a){"undefined"==typeof a&&(a=!0);var n,i=1;if(n="103-G-7T"===GetSelect2Text("Prod_id")?u["9607T"]:"103-G-2A"===GetSelect2Text("Prod_id")?u["9602A"]:u.normal,"undefined"!=typeof n[e]&&(t<n[e].w_min||t>n[e].w_max)&&(i=0,a)){var r=$(".validateData input[name="+e+"]:enabled").parents(".form-group").find("label").text();bsTips("【"+r+"】的值"+t+"不在指定范围内,产品判定为不合格，请仔细确认检查",0),c+=r+"、"}return i}function d(){var e=getRootPath(1)+"/assets/pages/controller/data/paper_physic.json";$.get(e,function(e){u=e})}function s(e){var t,a,n,i=100,r=1;return"undefined"==typeof e&&(e=0),n="103-G-7T"===GetSelect2Text("Prod_id")?u["9607T"]:"103-G-2A"===GetSelect2Text("Prod_id")?u["9602A"]:u.normal,e&&0==$('.validateData input[name="water_imbibition"]').val()&&(r=0),p="",$('.validateData input[type="text"]:enabled').each(function(e,o){if(t=$(this).attr("name"),a=$(this).val(),"undefined"!=typeof n[t]&&""!==a&&(a<n[t].min||a>n[t].max)){var d=$(".validateData input[name="+t+"]:enabled").parents(".form-group").find("label").text();"water_imbibition"==t||"sur_Strength"==t||"sur_oil_imbibition"==t||"PH_val"==t?r&&(i-=n[t].score,p+=d+"、"):(i-=n[t].score,p+=d+"、")}}),i}function l(){var e,t,a=1;"103-G-7T"===GetSelect2Text("Prod_id")?u["9607T"]:u.normal;return $('.normalPara input[type="text"]:enabled').each(function(n,i){e=$(this).attr("name"),t=$(this).val(),"0"==o(e,t,!0)&&(a=0)}),a}var c,p,m=function(){jQuery().datepicker&&$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"yyyy-mm-dd"})};$('select[name="oper_id"]').change(function(){n()||r()}),$('select[name="machine_id"]').change(function(){n()||r(),a()}),$('select[name="Prod_id"]').change(function(){return"103-G-7T"===GetSelect2Text("Prod_id")?($('input[name="water_imbibition"]').parent().find("span").text("20~40 g/m^2"),$('input[name="basis_weight"]').parent().find("span").text("95±3%"),$('input[name="thickness"]').parent().find("span").text("105-121"),$('input[name="whiteness"]').parent().find("span").text("81-85"),$('input[name="crumpled_porosity_front"]').parent().find("span").text("<=150"),$('input[name="crumpled_porosity_back"]').parent().find("span").text("<=150"),$('[name*="crumpled_porosity"]').attr("disabled",!1).parents(".form-group").show(),$('[name="fibre_tz12"]').attr("disabled",!1).parents(".form-group").show(),$('[name="anti_crumpled_dry"]').attr("disabled",!1).parents(".form-group").show()):($('input[name="water_imbibition"]').parent().find("span").text("40~70 g/m^2"),$('input[name="basis_weight"]').parent().find("span").text("90±3%"),$('input[name="thickness"]').parent().find("span").text("102-113"),$('input[name="whiteness"]').parent().find("span").text("80-84"),$('input[name="crumpled_porosity_front"]').parent().find("span").text(""),$('input[name="crumpled_porosity_front"]').parent().find("span").text(""),$('[name*="crumpled_porosity"]').attr("disabled",!0).val(0).parents(".form-group").hide(),$('[name="fibre_tz12"]').attr("disabled",!0).val(0).parents(".form-group").hide(),"103-G-2A"===GetSelect2Text("Prod_id")?$('[name="anti_crumpled_dry"]').attr("disabled",!0).val(0).parents(".form-group").hide():$('[name="anti_crumpled_dry"]').attr("disabled",!1).parents(".form-group").show()),n()?void $(".grey-cascade").html(""):void r()}),$('input[name="Reel_Code"]').on("blur",function(e){$(this).val().length>1&&"-1"!==$('select[name="Prod_id"]').val()&&i(),"更新"==$('.portlet button[type="submit"]').text().trim()&&$(this).data("reelcode")!=$(this).val()&&$('.portlet button[type="submit"]').text("提交")});var u={};$('.validateData input[type="text"]:enabled').on("change",function(){var e=s(),t=$(this).attr("name"),a=$(this).val();o(t,a,!0),$(".amounts h4").html("<strong>评价总分:</strong> "+e)}),$('.validateData input[type="text"]:enabled').on("keyup",function(){var e=s();$(".amounts h4").html("<strong>评价总分:</strong> "+e)}),$('input[name="Reel_Code"]').on("keyup",function(){var e=$(this);1==e.val().length&&SetSelect2Val("machine_id",e.val())});var h=function(){function t(){var e=getRootPath()+"/DataInterface/insert",t=getFormData("theForm"),a=s();$(".amounts h4").html("<strong>评价总分:</strong> "+a),t.tbl=TBL.PHYSIC,t.class_id=GetRadioChecked("class_id"),t.score=a,t.utf2gbk=["remark"],t.record_Time=today(1),t.class_id=GetiCheckChecked("class_id"),t.isNormal=l(),t.isNormal?t.score<100&&(t.remark="扣分项:"+jsOnRight(p,1)):(t.remark="不合格项:"+jsOnRight(c,1),t.score<100&&(t.remark+="    扣分项:"+jsOnRight(p,1))),$.post(e,t,function(e,t){if("success"==t){var a=$.parseJSON(e);infoTips(a.message,a.type),i(),$(".portlet.light").hide()}else infoTips("保存设置失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(e))})}function n(){var e=getRootPath()+"/DataInterface/update",t=getFormData("theForm");t.tbl=TBL.PHYSIC,t.class_id=GetRadioChecked("class_id"),t.score=s(1),t.utf2gbk=["remark"],t.record_Time=today(1),t.class_id=GetiCheckChecked("class_id"),t.id=$('.portlet button[type="submit"]').data("sn"),t.isNormal=l(),t.isNormal?t.score<100&&(t.remark="扣分项:"+jsOnRight(p,1)):(t.remark="不合格项:"+jsOnRight(c,1),t.score<100&&(t.remark+="    扣分项:"+jsOnRight(p,1))),bsTips(1==t.isNormal?"合格":"不合格"),$.post(e,t,function(e,t){if("success"==t){var a=$.parseJSON(e);infoTips(a.message,a.type),i(),$(".portlet.light").hide(),$(".normalPara input").removeAttr("disabled"),$('.portlet button[type="submit"]').html($('.portlet button[type="submit"]').html().replace("更新","提交"))}else infoTips("保存设置失败，请稍后重试或联系管理员!",0),infoTips(JSON.stringify(e))})}function i(){a(),$('form input[type="text"]').val(""),$(".amounts h4").html("<strong>评价总分:</strong> 100"),$('.portlet button[type="submit"]').html($('.portlet button[type="submit"]').html().replace("更新","提交")),$("#checkbox2").iCheck("check"),$(".normalPara input").removeAttr("disabled"),SetSelect2Val("oper_id",-1),SetSelect2Val("Prod_id",-1),SetSelect2Val("machine_id",-1),$(".portlet.light").hide(),$("input[name='rec_date']").val(today(6)),e(),c="",p=""}var r=getValidateRule("theForm");r.Reel_Code={minlength:4,maxlength:7,number:!1,required:!0},r.rec_date.number=!1,r.water_imbibition={required:!1},r.PH_val={required:!1},r.sur_Strength={required:!1},r.sur_oil_imbibition={required:!1},$("form[name=theForm]").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!0,rules:r,messages:{Reel_Code:{required:"轴号不能为空."}},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},submitHandler:function(e){}}),$('button[type="submit"]').on("click",function(){$("form[name=theForm]").validate().form()?"提交"==$('.portlet button[type="submit"]').text().trim()?t():n():infoTips("请确保所有必要信息均正确输入")}),$('a[name="reset"]').on("click",function(){i()}),$("#checkbox2").on("ifChecked",function(){var e=$(this).prop("checked")?1:0;e?$(".normalPara input").removeAttr("disabled"):$(".normalPara input").attr("disabled","true")})};return{init:function(){$(".portlet.light").hide(),$(".normalParaEdit").hide(),m(),t(),a(),h(),d()}}}();jQuery(document).ready(function(){initDom(),iChechBoxInit(),$("#checkbox2").iCheck("check"),PaperParam.init()}),jQuery(window).resize(function(){HeadFix()});
//# sourceMappingURL=PaperPara.min.js.map