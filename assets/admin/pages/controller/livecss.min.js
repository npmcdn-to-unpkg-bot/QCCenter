var livecss={pollFrequency:1e3,outstandingRequests:{},filesLastModified:{},watchTimers:{},watchAll:function(){this.unwatchAll();var a=setInterval(this.proxy(function(){for(var a=document.getElementsByTagName("link"),b=["screen","handheld","all",""],c=0;c<a.length;c++){var d=(a[c].getAttribute("media")||"").toLowerCase();"stylesheet"==a[c].getAttribute("rel")&&livecss.indexOf(b,d)>=0&&this.isLocalLink(a[c])&&this.refreshLinkElement(a[c])}}),this.pollFrequency);this.watchTimers.all=a},watch:function(a){var b=a.getAttribute("href");this.unwatch(b),this.watchTimers[b]=setInterval(this.proxy(function(){var a=this.linkElementWithHref(b);this.refreshLinkElement(a)}),this.pollFrequency)},unwatchAll:function(){for(var a in this.watchTimers)this.unwatch(a)},unwatch:function(a){null!==this.watchTimers[a]&&(clearInterval(this.watchTimers[a]),delete this.watchTimers[a],delete this.outstandingRequests[a])},linkElementWithHref:function(a){for(var b=document.getElementsByTagName("link"),c=0;c<b.length;c++)if(b[c].href==a)return b[c]},replaceLinkElement:function(a,b){var c=a.parentNode,d=a.nextSibling,e=this.addCacheBust(a.href),f=document.createElement("link");f.href=e,f.setAttribute("rel","stylesheet"),d?c.insertBefore(f,d):c.appendChild(f);var g=setInterval(this.proxy(function(){this.isCssElementLoaded(f)&&("undefined"!=typeof console&&console.log("CSS refreshed:",this.removeCacheBust(e)),clearInterval(g),delete this.outstandingRequests[this.removeCacheBust(e)],c.removeChild(a))}),100)},refreshLinkElement:function(a){var b=this.removeCacheBust(a.getAttribute("href"));if(!this.outstandingRequests[b]){var c=new XMLHttpRequest;this.outstandingRequests[b]=c;var d=this.addCacheBust(b);c.onreadystatechange=this.proxy(function(e){if(4==c.readyState&&(delete this.outstandingRequests[b],200==c.status||304==c.status)){var f=Date.parse(c.getResponseHeader("Last-Modified"));(!this.filesLastModified[b]||this.filesLastModified[b]<f)&&(this.filesLastModified[b]=f,this.replaceLinkElement(a,d))}}),c.open("HEAD",d),c.send(null)}},isCssElementLoaded:function(a){try{return a.sheet&&a.sheet.cssRules.length>0}catch(b){}return!1},isLocalLink:function(a){var b=a.href,c=new RegExp("^/|^"+document.location.protocol+"//"+document.location.host);return 0===b.search(c)},addCacheBust:function(a){return this.removeCacheBust(a)+"?cache_bust="+(new Date).getTime()},removeCacheBust:function(a){return a.replace(/\?cache_bust=[^&]+/,"")},proxy:function(a){var b=this;return function(){return a.apply(b,[])}},indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1},addEventListener:function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}};window.location.search.toString().indexOf("startlivecss=true")>=0&&livecss.addEventListener(window,"load",function(){livecss.watchAll()});