function WorkLogInit(){$("#ErrDesc").summernote({height:300,minHeight:null,maxHeight:null,focus:!0}),$(".form_advance_datetime").datetimepicker({isRTL:Metronic.isRTL(),format:"yyyy-mm-dd hh:ii",autoclose:!0,todayBtn:!0,startDate:"2015-01-01 00:00",pickerPosition:Metronic.isRTL()?"bottom-right":"bottom-left",minuteStep:10,language:"zh-CN"}),$("#ProUserName").multiSelect({keeporder:!0,selectableHeader:"<div class='custom-header'>\u53ef\u9009\u540d\u5355</div>",selectionHeader:"<div class='custom-header'>\u5df2\u9009\u62e9</div>",selectableOptgroup:!0,afterSelect:function(a){for(var b=a.length-1;b>=0;b--){var c=a[b];iProUserName[c]=1}},afterDeselect:function(a){for(var b=a.length-1;b>=0;b--){var c=a[b];iProUserName[c]=0}}}),$("#TransUserName").multiSelect({keeporder:!0,selectableHeader:"<div class='custom-header'>\u53ef\u9009\u540d\u5355</div>",selectionHeader:"<div class='custom-header'>\u5df2\u9009\u62e9</div>",selectableOptgroup:!0,afterSelect:function(a){for(var b=a.length-1;b>=0;b--){var c=a[b];iTransUserName[c]=1}},afterDeselect:function(a){for(var b=a.length-1;b>=0;b--){var c=a[b];iTransUserName[c]=0}}})}function QueryWorkLogData(a){var j,b=$("#ProcID").val(),c=$("#LoadingNum").val(),d=$("#ProStatus").val(),e=$("#KeyWord").val(),f=a?0:$("#LogID").val(),g=$("#dashboard-report-range span").html(),h=g.split(" ~ ")[0],i=g.split(" ~ ")[1],k=getRootUrl("worklog")+"QueryLogInfo";switch(c){case"1":j=20;break;case"2":j=30;break;case"3":j=40;break;case"4":j=50}$.post(k,{ProcID:b,Nums:j,Status:d,KeyWord:e,CurID:f,TimeStart:h,TimeEnd:i},function(b,c){var d=jQuery.parseJSON(b);if(d.rows>0){a&&$(".timeline").html("");for(var e='<div class="timeline-item"><div class="timeline-badge"><div class="timeline-badge"><img class="timeline-badge-userpic" src="http://localhost/assets/admin/pages/media/users/realeve.jpg"></div></div><div class="timeline-body"><div class="timeline-body-arrow"></div><div class="timeline-body-head"><div class="timeline-body-head-caption"><a href="#" class="timeline-body-title font-blue-madison">',f='</a><span class="timeline-body-time font-grey-cascade">\u53d1\u8868\u4e8e',g="</span></div></div></div>",h=d.rows-1;h>=0;h--){var i='</small></span></div><div class="timeline-body-head-actions"><div class="btn-group"><button class="btn btn-circle green-haze btn-sm dropdown-toggle" type="button" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">\u64cd\u4f5c <i class="fa fa-angle-down"></i></button><ul class="dropdown-menu pull-right" role="menu"><li><a href="http://localhost/worklog/editlog?ID='+d.data[h].ID+'" id="UpdateLog'+h+'" ><i class="icon-pencil"></i>&nbsp;&nbsp;\u7f16\u8f91 </a></li>';i+='<li><a href="http://localhost/worklog/Dellog?ID='+d.data[h].ID+'" id="DelLog'+h+'" data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="\u786e\u5b9a\u5220\u9664\u8be5\u6761\u65e5\u5fd7?" data-btn-ok-label="\u662f" data-btn-ok-icon="icon-trash" data-btn-ok-class="btn-success" data-btn-cancel-label="\u53d6\u6d88" data-btn-cancel-icon="icon-close" data-btn-cancel-class="btn-danger"><i class="icon-trash"></i>&nbsp;&nbsp;\u5220\u9664 </a></li>',i+='<li><a href="http://localhost/worklog/Marklog?ID='+d.data[h].ID+'" id="MarkLog"><i class="icon-star"></i>&nbsp;&nbsp;\u6536\u85cf </a></li><li class="divider"></li>',i+='<li><a href="http://localhost/worklog/Completelog?ID='+d.data[h].ID+'" id="CompleteLog'+h+'"  data-toggle="confirmation" data-singleton="true" data-popout="true" data-placement="left" data-title="\u786e\u5b9a\u6807\u8bb0\u4e3a\u5df2\u5b8c\u6210?" data-btn-ok-label="\u662f" data-btn-ok-icon="icon-check" data-btn-ok-class="btn-success" data-btn-cancel-label="\u53d6\u6d88" data-btn-cancel-icon="icon-close"><i class="icon-check"></i>&nbsp;&nbsp;\u6807\u8bb0\u4e3a\u5df2\u5b8c\u6210 </a></li>',i+='</ul></div></div></div><div class="timeline-body-content"><span class="font-grey-cascade">';var j=ReadLog(d.data[h].ID);$(".timeline:first").prepend(e+d.data[h].RecordUserName+f+d.data[h].RecordTime+i+j+g)}$("#LogID").val(d.data[0].ID)}else infoTips("\u8be5\u641c\u7d22\u6761\u4ef6\u8303\u56f4\u5185\u65e0\u65e5\u5fd7\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e!</br>\u9519\u8bef\u4fe1\u606f\uff1a"+c+"</br>\u8fd4\u56de\u503c:"+b,1)})}function ReadLog(a){var b=getRootUrl("worklog")+"ReadLog",c="\u8be5\u6761\u8bb0\u5f55\u672a\u586b\u5199\u4efb\u4f55\u65e5\u5fd7";return $.ajax({type:"POST",async:!1,url:b,data:{ID:a},success:function(a){c=a}}),c}function ReadLogSettings(){var a=getRootUrl("worklog")+"ReadLogQuerySettings";$.ajax({type:"POST",async:!1,url:a,success:function(a){var b=jQuery.parseJSON(a),c=b.data[0];$("#ProcID").val(c.ProcID),$("#LoadingNum").val(c.NumsID),$("#ProStatus").val(c.Status),$("#RefreshTime").val(c.RefreshTime),0===c.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState"),$("#QueryData").click()}})}function PromotAlert(){bootbox.prompt("What is your name?",function(a){null===a?alert("Prompt dismissed"):alert("Hi <b>"+a+"</b>")})}$("#SaveChanges").click(function(){for(var a=GetSwitchValue("workProc",4),b=GetSwitchValue("workClass",3),c=$("#MachineName").val(),d=$("#ProductName").val(),e=$("#ProStatus").val(),f=$("#ProTime").val(),g="",h="",i=["\u65e0","\u4e8e\u6f47","\u4e30\u950b","\u5f6d\u9e4f","\u8d75\u6587\u5029","\u84b2\u660e\u73a5","\u8212\u7ca4","\u9a6c\u53ef","\u80e1\u65b0\u73a5","\u674e\u8d85\u7fa4","\u5f90\u95f5","\u674e\u5bbe","\u6768\u6797","\u91d1\u946b","\u5305\u8bda"],j=iProUserName.length-1;j>=0;j--)iProUserName[j]&&(""!==h&&(h+=","),h+=i[j]);for(j=iTransUserName.length-1;j>=0;j--)iTransUserName[j]&&(""!==g&&(g+=","),g+=i[j]);""===h&&(h="\u65e0"),""===g&&(g="\u65e0");var k=$("#ProInfo").val(),l=$("#ReportOutput").bootstrapSwitch("state")===!0?1:0,m=$("#RecordUserName").val(),n=$("#RecordTime").val(),o=$("#MainDesc").val(),p=$("#SubDesc").val(),q=$("#ErrDesc").code(),r=getRootUrl("worklog")+"AddLog";$.post(r,{WorkProc:a,WorkClass:b,MachineName:c,ProductName:d,ProStatus:e,ProTime:f,ProUserName:h,TransUserName:g,ProInfo:k,ReportOutput:l,RecordUserName:m,RecordTime:n,MainDesc:o,SubDesc:p,ErrDescHTML:q},function(a,b){var c=jQuery.parseJSON(a);c>0?infoTips("\u65e5\u5fd7\u6dfb\u52a0\u6210\u529f\uff0c\u8bf7\u7ee7\u7eed\u6dfb\u52a0\uff01</br>\u66f4\u65b0\u72b6\u6001\uff1a"+b+"</br>\u6240\u6dfb\u52a0\u6570\u636eID:"+a,1):infoTips("\u65e5\u5fd7\u6dfb\u52a0\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u62fc\u5199\u6216\u8054\u7cfb\u7ba1\u7406\u5458!</br>\u9519\u8bef\u4fe1\u606f\uff1a"+b+"</br>\u6240\u6dfb\u52a0\u6570\u636e:"+a,0)})}),$("#dashboard-report-range").on("apply.daterangepicker",function(){QueryWorkLogData(1)}),$("#QueryData").click(function(){QueryWorkLogData(1)}),$("#SaveSettings").click(function(){var a=$("#ProcID").val(),b=$("#LoadingNum").val(),c=$("#ProStatus").val(),d=$("#RefreshTime").val(),e=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,f=getRootUrl("worklog")+"SaveLogQuerySettings";$.post(f,{ProcID:a,NumsID:b,Status:c,RefreshTime:d,AutoRefresh:e},function(a,b){if("success"==b){var c=jQuery.parseJSON(a);infoTips(c.message,1)}else infoTips("\u4fdd\u5b58\u8bbe\u7f6e\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458!",0)})}),$("#DelLog1").on("confirmed.bs.confirmation",function(){infoTips("\u5220\u9664\u6210\u529f",1)}),$("#CompleteLog1").on("confirmed.bs.confirmation",function(){infoTips("\u8be5\u6761\u65e5\u5fd7\u5df2\u6807\u8bb0\u4e3a\u5df2\u5b8c\u6210",1)}),$("#Preview").click(function(){});