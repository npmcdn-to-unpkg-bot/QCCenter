function SaveSettings(){var a=$("#RefreshTime").val(),b=$("#AutoRefresh").bootstrapSwitch("state")===!0?1:0,c=$("#FixTblHead").bootstrapSwitch("state")===!0?1:0,d=$("#FixTblCol").bootstrapSwitch("state")===!0?1:0,e=$("#FootSearch").bootstrapSwitch("state")===!0?1:0,f=$("#InputToggle").bootstrapSwitch("state")===!0?1:0,g=$("#InputInner").bootstrapSwitch("state")===!0?1:0,h=getRootUrl("QualityTable")+"/SaveSettings";$.post(h,{RefreshTime:a,AutoRefresh:b,FixTblHead:c,FixTblCol:d,FootSearch:e,InputToggle:f,InputInner:g},function(a,b){if("success"==b){var c=jQuery.parseJSON(a);infoTips(c.message,1)}else infoTips("\u4fdd\u5b58\u8bbe\u7f6e\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458!",0)})}function ReadSettings(){var a=getRootUrl("QualityTable")+"/ReadSettings";$.ajax({type:"POST",async:!1,url:a,success:function(a){var b=jQuery.parseJSON(a),c=b.data[0];$("#RefreshTime").val(c.RefreshTime),0===c.AutoRefresh&&$("#AutoRefresh").bootstrapSwitch("toggleState"),0===c.FixTblHead&&$("#FixTblHead").bootstrapSwitch("toggleState"),0===c.FixTblCol&&$("#FixTblCol").bootstrapSwitch("toggleState"),0===c.FootSearch&&$("#FootSearch").bootstrapSwitch("toggleState"),0===c.InputToggle&&$("#InputToggle").bootstrapSwitch("toggleState"),0===c.InputInner&&$("#InputInner").bootstrapSwitch("toggleState")}})}$("#HideTips").click(function(){$(".note.note-success").addClass("hide")}),$("#SaveSettings").click(function(){SaveSettings()});var dataTable=function(){function d(a){var b;return b={bRetrieve:!0,language:{url:getRootPath()+"/assets/admin/pages/controller/DataTableLanguage.json"},order:[[1,"asc"]],lengthMenu:[[5,10,15,20,50,100,-1],[5,10,15,20,50,100,"All"]],pageLength:15,dom:"<'row tbTools' <'col-md-6 col-sm-12 pull-right'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>>t<'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",buttons:[{extend:"copyHtml5",exportOptions:{columns:":visible"},text:"\u590d\u5236"},{extend:"excelHtml5",exportOptions:{columns:":visible"}},{extend:"csvHtml5",exportOptions:{columns:":visible"}},{extend:"pdfHtml5",orientation:a.cols>10?"landscape":"portrit",pageSize:a.cols>10?"A3":"A4",message:a.source+"\n\xa9\u6210\u90fd\u5370\u949e\u6709\u9650\u516c\u53f8 \u6280\u672f\u8d28\u91cf\u90e8",title:a.title,exportOptions:{columns:":visible"}},{extend:"print",autoPrint:!1,text:"\u6253\u5370",message:a.source+"<br>\xa9\u6210\u90fd\u5370\u949e\u6709\u9650\u516c\u53f8 \u6280\u672f\u8d28\u91cf\u90e8",title:a.title,exportOptions:{columns:":visible"}},{extend:"colvis",text:'\u9690\u85cf\u6570\u636e\u5217<i class="fa fa-angle-down"></i>',className:"btn-fit-height green-haze dropdown-toggle"}],bDeferRender:!0,bProcessing:!0,bStateSave:!0,bserverSide:!1,bInfo:!0,bAutoWidth:!0,bSortClasses:!1,aoColumns:a.header,data:a.data,bScrollInfinite:!0,searchHighlight:!0,colReorder:{realtime:!0},scroolY:"70v",scrollCollapse:!0,initComplete:function(){var b=this.api();b.$("td").click(function(){b.search(this.innerText).draw()}),$(".tools").append($(".tabletools-btn-group").clone(!0)),$(".tbTools").remove(),infoTips(JSON.stringify(a),2)}}}function e(b,c){var e=$(b),f=d(c);a=e.dataTable(f)}function f(b,c){var d=$(b);if(Data=ReadData(c),$("#TableTitle").text(Data.title),$("#datasource").text("("+Data.source+")"),!(Data.rows>0))return void infoTips("\u8be5\u65f6\u95f4\u8303\u56f4\u5185\u65e0\u8d28\u91cf\u6570\u636e\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u67e5\u8be2\u65f6\u95f4!",1);if(!$("#sample tbody").length)return void e(b,Data);a=d.dataTable(),a.fnClearTable(this);for(var f=a.fnSettings(),g=0;g<Data.rows;g++)a.oApi._fnAddData(f,Data.data[g]);f.aiDisplay=f.aiDisplayMaster.slice(),a.fnDraw(),infoTips(JSON.stringify(Data),2)}var a;return{init:function(){$("#Preview").click(function(){var a=$("#PreviewUrl").val();f("#sample",a)})}}}(),FormEditable=function(){$.mockjaxSettings.responseTime=100;var a=function(){$.mockjax({url:"/post"}),$.mockjax({url:"/DBGroups",response:function(a){this.responseText=[{value:0,text:"\u8d28\u91cf\u7efc\u5408\u7ba1\u7406\u7cfb\u7edf"},{value:1,text:"\u5c0f\u5f20\u6838\u67e5"},{value:2,text:"\u7801\u540e\u6838\u67e5"},{value:3,text:"\u673a\u53f0\u4f5c\u4e1a"},{value:4,text:"\u5e93\u7ba1\u7cfb\u7edf"}]}})},b=function(){var b=($("#InputToggle").bootstrapSwitch("state")===!0?1:0,$("#InputInner").bootstrapSwitch("state")===!0?1:0);b&&($.fn.editable.defaults.mode="inline"),$.fn.editable.defaults.inputclass="form-control",$.fn.editable.defaults.url="/post",$("#ApiName").editable({validate:function(a){return""===$.trim(a)?"\u8be5\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a":void 0},url:"/post",type:"text",pk:1,name:"ApiName",title:"\u8bf7\u8f93\u5165\u63a5\u53e3\u540d\u79f0"}),$("#Author").editable({validate:function(a){return""===$.trim(a)?"\u8be5\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a":void 0}}),$("#DataBaseID").editable({name:"DBID",inputclass:"form-control",source:[{value:0,text:"\u8d28\u91cf\u7efc\u5408\u7ba1\u7406\u7cfb\u7edf"},{value:1,text:"\u5c0f\u5f20\u6838\u67e5"},{value:2,text:"\u7801\u540e\u6838\u67e5"},{value:3,text:"\u673a\u53f0\u4f5c\u4e1a"},{value:4,text:"\u5e93\u7ba1\u7cfb\u7edf"},{value:5,text:"\u8d28\u91cf\u63a7\u5236\u4e2d\u5fc3"}]}),$("#CreateDate").editable({format:"yyyy-mm-dd hh:ii",viewformat:"yyyy-mm-dd hh:ii",datetimepicker:{rtl:Metronic.isRTL(),todayBtn:"linked",weekStart:1}}),$("#SQL").editable({name:"strSQL",showbuttons:"bottom",rows:8,inputclass:"form-control",tpl:'<textarea style="min-width:430px;"></textarea>',validate:function(a){return""===$.trim(a)?"\u8be5\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a":void 0}}),$("#params").editable({inputclass:"form-control input-medium",select2:{tags:["tstart","tend","tstart2","tend2","tstart3","tend3","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10"],tokenSeparators:[","," "]},validate:function(a){return""===$.trim(a)?"\u8be5\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a":void 0},success:function(a,b){if(""!==$.trim(b)){for(var c=$("#url").text(),d=0,e="";d<b.length;d++){var f=d+1;e+="&"+b[d]+"=\u53c2\u6570"+f}return c+=e,$("#PreviewUrl").val($.trim(c)),b}}}),$("#note").editable({showbuttons:Metronic.isRTL()?"left":"right",name:"ApiDesc"}),$("#pencil").click(function(a){a.stopPropagation(),a.preventDefault(),$("#note").editable("toggle")}),$("#url").editable({name:"URL",disabled:!0}),$("#ApiID").editable({disabled:!0})};return{init:function(){a(),b(),$("#edit").click(function(){$("#user .editable").editable("toggleDisabled"),$("#url").editable("disable"),$("#ApiID").editable("disable")}),$("#InputInner").on("switchChange.bootstrapSwitch",function(a){SaveSettings(),window.location.reload()}),$("#user .editable").on("hidden",function(a,b){if("save"===b||"nochange"===b){var c=$(this).closest("tr").next().find(".editable");InputToggle?setTimeout(function(){c.editable("show")},300):c.focus()}}),$("#SaveAPI").click(function(){var a=getRootUrl("DataInterface")+"SaveAPI",b=$("#user .editable").editable("getValue");return""===b.ApiName||""===b.SQL||""===b.params?void infoTips("\u63a5\u53e3\u540d\u3001\u67e5\u8be2\u8bed\u53e5\u4ee5\u53ca\u63a5\u53e3\u53c2\u6570\u4e0d\u5141\u8bb8\u4e3a\u7a7a,\u8bf7\u68c0\u67e5\u540e\u91cd\u65b0\u63d0\u4ea4",1):void $.post(a,b,function(a){var c=jQuery.parseJSON(a);if(infoTips(c.message,1),c.status){$("#Reset").click(),$("#ApiID").editable("setValue",c.NewID);var d="&ID="+b.ApiID,e=parseInt(b.ApiID,10)+1,f="&ID="+e,g=b.URL.replace(d,f);$("#url").editable("setValue",g),$("#DemoUrl").text(g),$("#DemoUrl").attr("href",g)}})}),$("#Reset").click(function(){$("#ApiName").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved"),$("#DataBaseID").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved"),$("#SQL").editable("setValue",null).editable("option","pk",null).removeClass("editable-unsaved");var a='[\u529f\u80fd\u8bf4\u660e]<p style="text-indent:2em;">\u672c\u63a5\u53e3\u4e3b\u8981\u7528\u4e8e <i>XX</i> \u4fe1\u606f\u7684\u67e5\u8be2.</p>[\u4e3b\u8981\u53c2\u6570]';a+="<ul><li>TimeStart:\u5f00\u59cb\u65f6\u95f4\uff1b</li><li> TimeEnd:\u5f00\u59cb\u65f6\u95f4\uff1b</li><li> Cols:1/0,\u9ed8\u8ba4\u4e3a\u7a7a\uff0c\u8bbe\u4e3a1\u65f6\u8fd4\u56de\u67e5\u8be2\u8bed\u53e5\u7684\u5217\u7528\u4e8e\u8868\u683c\u521d\u59cb\u5316\u7b49\u64cd\u4f5c\uff1b</li></ul>",$("#note").editable("setValue",a).editable("option","pk",null).removeClass("editable-unsaved")})}}}();