define(["./js/extension/dataTool"],function(e){function t(e,t){var i={};return t=t?"GET":"POST",$.ajax({type:t,async:!1,url:e,success:function(e,t){var a=jQuery.parseJSON(e);i=a},error:function(e){console.log("read data error:<br>"),console.log(e.responseText)}}),i}var a=function(a){function s(e,t){return e-t}function r(e){e.sort();var t=[e[0]],i=0;return e.map(function(e){e!=t[i]&&(t.push(e),i++)}),t}function o(e){return["序列 "+e.seriesName+": ","分组 "+e.name+": ","上边缘: "+e.data[4].toFixed(2),"上四分位(Q1): "+e.data[3].toFixed(2),"中位数: "+e.data[2].toFixed(2),"下四分位(Q3): "+e.data[1].toFixed(2),"下边缘: "+e.data[0].toFixed(2)].join("<br/>")}function l(e){return["序列 "+e.seriesName+": ","分组 "+e.name+": ","最大值: "+e.data[4].toFixed(2),"上四分位(Q1): "+e.data[3].toFixed(2),"中位数: "+e.data[2].toFixed(2),"下四分位(Q3): "+e.data[1].toFixed(2),"最小值: "+e.data[0].toFixed(2)].join("<br/>")}function n(e,t){var i=[];return e.map(function(e,a){i[a]=e[t]}),r(i.sort(s))}function d(e){var i,a,s,r,o=[];if(i=t(e.url),o.title=i.title,o.subTitle=i.source,o.rows=i.rows,0===i.rows)return o;if(3==i.cols){for(o.xAxisTitle=i.header[1].title,o.yAxisTitle=i.header[2].title,o.legend=n(i.data,0),o.xAxis=n(i.data,1),o.yAxis=[],s=0;s<o.legend.length;s++)for(o.yAxis[o.legend[s]]=[],r=0;r<o.xAxis.length;r++)o.yAxis[o.legend[s]][r]="-";for(s=0;s<i.rows;s++)for(a=i.data[s][0],r=0;r<o.xAxis.length;r++)if(i.data[s][1]==o.xAxis[r]){o.yAxis[a][r]=parseFloat(i.data[s][2]);break}for(o.series=[],s=0;s<o.legend.length;s++)o.series[s]={name:o.legend[s],type:e.type,smooth:e.smooth,barMaxWidth:e.barMaxWidth,data:o.yAxis[o.legend[s]],itemStyle:dataStyle_iT},e.lineAreaStyle&&(o.series[s].areaStyle={normal:{}}),e.reverse||(e.markLine&&(o.series[s].markLine=MLnStyle_avg),e.markPoint&&(o.series[s].markPoint=MPtStyleBoth)),"line"==e.type&&(o.series[s].itemStyle.normal={show:!1})}else if(2==i.cols){for(o.xAxisTitle=i.header[0].title,o.yAxisTitle=i.header[1].title,o.xAxis=n(i.data,0),o.yAxis=[],s=0;s<o.xAxis.length;s++)o.yAxis[s]="-";for(s=0;s<i.rows;s++)o.yAxis[s]=parseFloat(i.data[s][1]);o.legend=[],o.legend[0]=o.yAxisTitle,o.series=[],o.series[0]={name:o.yAxisTitle,type:e.type,smooth:e.smooth,barMaxWidth:e.barMaxWidth,data:o.yAxis,itemStyle:dataStyle_iT},e.lineAreaStyle&&(o.series[0].areaStyle={normal:{}}),e.reverse||(e.markLine&&(o.series[0].markLine=MLnStyle_avg),e.markPoint&&(o.series[0].markPoint=MPtStyleBoth))}else if(1==i.cols){for(o.xAxisTitle="数据编号",o.yAxisTitle=i.header[0].title,o.legend=[],o.legend[0]=o.yAxisTitle,arrTemp=[],s=0;s<i.rows;s++)arrTemp[s]=s+1;for(o.xAxis=arrTemp,o.yAxis=[],s=0;s<i.rows;s++)o.yAxis[s]=parseFloat(i.data[s][0]);o.series=[],o.series[0]={name:o.yAxisTitle,type:e.type,smooth:e.smooth,barMaxWidth:e.barMaxWidth,data:o.yAxis,itemStyle:dataStyle_iT},e.lineAreaStyle&&(o.series[0].areaStyle={normal:{}}),e.reverse||(e.markLine&&(o.series[0].markLine=MLnStyle_avg),e.markPoint&&(o.series[0].markPoint=MPtStyleBoth))}return o}function x(e,t){for(var i=0;i<t.length;i++)t[i].sort(s),e.boxData[i][0]=t[i][0],e.boxData[i][4]=t[i][t[i].length-1];return e}function h(a){var s,r=t(a.url),d=[];if(d.title=r.title,d.subTitle=r.source,d.rows=r.rows,0===r.rows)return d;if(3==r.cols){d.xAxisTitle=r.header[1].title,d.yAxisTitle=r.header[2].title,d.legend=n(r.data,0),d.xAxis=n(r.data,1),d.series=[];var h=[];for(i=0;i<d.legend.length;i++)for(h[d.legend[i]]=[],j=0;j<d.xAxis.length;j++)h[d.legend[i]][j]=[];for(i=0;i<r.rows;i++)for(iTemp=r.data[i][0],j=0;j<d.xAxis.length;j++)if(r.data[i][1]==d.xAxis[j]){h[iTemp][j].push(parseFloat(r.data[i][2]));break}d.legend.map(function(t,i){s=e.prepareBoxplotData(h[t],{layout:a.reverse?"vertical":"horizontal"}),a.minMax&&(s=x(s,h[t])),d.series[i]={name:t,type:a.type,data:s.boxData,tooltip:{formatter:a.minMax?l:o}},d.series[i+3]={name:t,type:"scatter",data:s.outliers}})}else if(2==r.cols){for(d.xAxisTitle=r.header[0].title,d.yAxisTitle=r.header[1].title,d.xAxis=n(r.data,0),d.yAxis=[],i=0;i<d.xAxis.length;i++)d.yAxis[i]=[];for(i=0;i<r.rows;i++)for(iTemp=r.data[i][0],j=0;j<d.xAxis.length;j++)if(iTemp==d.xAxis[j]){d.yAxis[j].push(parseFloat(r.data[i][1]));break}s=e.prepareBoxplotData(d.yAxis),d.legend=[],d.legend[0]=d.yAxisTitle,d.series=[],d.series[0]={name:d.yAxisTitle,type:a.type,data:s.boxData,tooltip:{formatter:o}},d.series[1]={name:d.yAxisTitle,type:"scatter",data:s.outliers}}else if(1==r.cols){for(d.xAxisTitle="数据编号",d.yAxisTitle=r.header[0].title,d.legend=[],d.legend[0]=d.yAxisTitle,d.xAxis=["数据1"],d.yAxis=[],d.yAxis[0]=[],i=0;i<r.rows;i++)d.yAxis[0][i]=parseFloat(r.data[i][0]);s=e.prepareBoxplotData(d.yAxis),d.series=[],d.series[0]={name:d.yAxisTitle,type:a.type,data:s.boxData,tooltip:{formatter:o}},d.series[1]={name:d.yAxisTitle,type:"scatter",data:s.outliers}}return d}function p(e,t,i){var a={},s=[];e.map(function(e){"undefined"==typeof a[e[t]]?a[e[t]]=parseFloat(e[i]):a[e[t]]+=parseFloat(e[i])});for(var r in a)s.push({value:a[r].toFixed(2),name:r});return s}function y(e,t,i,a){var s=[],r=0;return e.map(function(e){0===r?(s.push({value:parseFloat(e[i]).toFixed(2),name:e[t],itemStyle:{normal:{color:a[e[0]]}}}),r++):s[r-1].name==e[t]?(s[r-1].value=parseFloat(s[r-1].value)+parseFloat(e[i]),s[r-1].value=s[r-1].value.toFixed(2)):(s.push({value:parseFloat(e[i]).toFixed(2),name:e[t],itemStyle:{normal:{color:a[e[0]]}}}),r++)}),s}function u(e,t){var i=n(e.data,0),a={},s=t.length;return i.map(function(e,i){a[e]=t[i%s]}),a}function m(e){var a=t(e.url),s=[];if(s.title=a.title,s.subTitle=a.source,s.rows=a.rows,0===a.rows)return s;if(a.cols>2){var r=[];a.header.map(function(e){r.push(e.title)}),s.legend={orient:"vertical",x:"left",data:r};var o=u(a,e.color),l=a.cols-1,d=80/l;for(s.series=[],i=0;i<l;i++)s.series.push({name:a.header[i].title,type:"pie",selectedMode:"single",radius:[i*d+(i>0?0:5)+"%",(i+1)*d+"%"],data:y(a.data,i,l,o),label:{normal:{show:3>l,position:"inner"}},itemStyle:{normal:{borderColor:"#fbfbfb",borderWidth:1},emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}})}else if(2==a.cols)s.legend={orient:"vertical",x:"left",data:n(a.data,0)},s.series=[{name:a.header[0].title,type:e.type,selectedMode:"single",radius:[0,"30%"],data:p(a.data,0,2),itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}],e.circle||(s.series[0].radius=[0,"60%"],s.series[0].center=["50%","50%"]);else if(1==a.cols){s.legend={show:!1,orient:"vertical",x:"left",data:a.header[0].title};var x;a.data.map(function(e,t){x.push({value:parseFloat(e).toFixed(2),name:"数据"+(t+1)})}),s.series=[{name:a.header[0].title,type:e.type,selectedMode:"single",radius:[0,"30%"],data:x,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}],e.circle||(s.series[0].radius=[0,"60%"],s.series[0].center=["50%","50%"])}return a.cols<3&&(elem.data.length<=6?(s.series[0].label={normal:{position:"inner"}},s.series[0].labelLine={normal:{show:!1}}):s.series[0].labelLine={normal:{show:!0,length2:10,length:15}}),s}function c(e){var i=t(e.url),a=[];if(a.title=i.title,a.subTitle=i.source,a.rows=i.rows,0===i.rows)return a;if(3==i.cols)a.legend={orient:"vertical",x:"left",data:n(i.data,0).concat(n(i.data,1))},a.series=[{name:i.header[0].title,type:e.type,selectedMode:"single",radius:[0,"35%"],data:p(i.data,0,2),itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}},{name:i.header[1].title,type:e.type,radius:["50%","70%"],data:p(i.data,1,2),itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}],e.circle||(a.series[0].radius=[0,"50%"],a.series[1].radius=[0,"50%"],a.series[0].center=["25%","50%"],a.series[1].center=["75%","50%"]),"0"!=e.roseType&&(a.series[0].roseType=e.roseType,a.series[0].radius=["10%","50%"],a.series[0].center=["25%","50%"],a.series[1].roseType=e.roseType,a.series[1].radius=["10%","50%"],a.series[1].center=["75%","50%"]);else if(2==i.cols)a.legend={orient:"vertical",x:"left",data:n(i.data,0)},a.series=[{name:i.header[0].title,type:e.type,selectedMode:"single",radius:[0,"30%"],data:p(i.data,0,2),itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}],e.circle||(a.series[0].radius=[0,"60%"],a.series[0].center=["50%","50%"]);else if(1==i.cols){a.legend={show:!1,orient:"vertical",x:"left",data:i.header[0].title};var s;i.data.map(function(e,t){s.push({value:parseFloat(e).toFixed(2),name:"数据"+(t+1)})}),a.series=[{name:i.header[0].title,type:e.type,selectedMode:"single",radius:[0,"30%"],data:s}],e.circle||(a.series[0].radius=[0,"60%"],a.series[0].center=["50%","50%"])}return a.series.map(function(e,t){e.data.length<=6?(a.series[t].label={normal:{position:"inner"}},a.series[t].labelLine={normal:{show:!1}}):a.series[t].labelLine={normal:{show:!0,length2:10,length:15}}}),a}var f;switch(a.type){case"bar":case"line":f=d(a);break;case"boxplot":f=h(a);break;case"pie":case"funnel":f=c(a);break;case"sunrise":f=m(a)}return f},s=function(e){var t=a(e);if(0==t.rows)return!1;var i,s=function(e){var i={title:[{text:t.title,subtext:t.subTitle,x:"center"},{text:"©成都印钞有限公司 技术质量部",borderColor:"#999",borderWidth:0,textStyle:{fontSize:14},x2:10,y2:5}],grid:{left:"5%",right:"5%",top:"10%",bottom:"10%",containLabel:!0},toolbox:{show:e.toolbox,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},dataZoom:{show:!0},magicType:{show:!0,type:["line","bar","stack","tiled"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,tooltip:{trigger:"boxplot"==e.type?"item":"axis"},dataZoom:[{type:"inside",realtime:!0,start:0,end:100},{show:"h"==e.dataZoom||"vh"==e.dataZoom,realtime:!0,start:0,end:100,height:20,y2:25},{type:"inside",yAxisIndex:0,realtime:!0,start:0,end:100},{show:"v"==e.dataZoom||"vh"==e.dataZoom,yAxisIndex:0,filterMode:"empty",width:12,height:"70%",handleSize:8,showDataShadow:!1,right:5}],legend:{data:t.legend,x:"center",y:70,itemGap:20,textStyle:{fontSize:16},show:!(t.legend.length<=1)},xAxis:[{name:t.xAxisTitle,axisTick:{show:!1},type:"category",boundaryGap:"line"!=e.type,data:t.xAxis}],yAxis:[{name:t.yAxisTitle,type:"value",position:"left",scale:!0,axisLabel:{show:!0,interval:"auto",margin:8},axisTick:{show:!1}}],series:t.series};if("boxplot"==e.type&&(i.title[2]={text:"上边缘: Q3 + 1.5 * IRQ \n下边缘: Q1 - 1.5 * IRQ\nIRQ: Q3-Q1",borderColor:"#999",borderWidth:1,textStyle:{fontSize:14},x2:10,y:30},e.minMax&&(i.title[2].text="上边缘: 最大值 \n下边缘: 最小值")),e.reverse){var a;a=i.xAxis,i.xAxis=i.yAxis,i.yAxis=a}return i},r=function(e){var i={title:[{text:t.title,subtext:t.subTitle,x:"center"},{text:"©成都印钞有限公司 技术质量部",borderColor:"#999",borderWidth:0,textStyle:{fontSize:14},x2:10,y2:5}],tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},grid:{left:"5%",right:"5%",top:"10%",bottom:"10%",containLabel:!0},toolbox:{show:e.toolbox,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,legend:t.legend,series:t.series};return"funnel"==e.type&&(i.series.length>1?(i.series[0].width="60%",i.series[0].height="40%",i.series[0].left="20%",i.series[0].top="10%",i.series[0].label={normal:{position:"inner"}},i.series[0].labelLine={normal:{show:!1}},i.series[1].width="60%",i.series[1].height="40%",i.series[1].left="20%",i.series[1].top="50%",i.series[1].sort="ascending",i.series[1].label={normal:{position:"inner"}},i.series[1].labelLine={normal:{show:!1}}):(i.series[0].width="60%",i.series[0].height="60%",i.series[0].left="20%",i.series[0].top="20%",i.series[0].sort="ascending",i.series[0].label={normal:{position:"inner"}},i.series[0].labelLine={normal:{show:!1}})),i};switch(e.type){case"bar":case"line":case"boxplot":i=s(e);break;case"pie":case"funnel":case"sunrise":i=r(e)}return i};return{getOption:s}});